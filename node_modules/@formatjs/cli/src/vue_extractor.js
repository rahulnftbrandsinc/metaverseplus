"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.parseFile = void 0;
var compiler_sfc_1 = require("@vue/compiler-sfc");
function walk(node, visitor) {
    if (node.type === 2 /* TEXT */ ||
        node.type === 3 /* COMMENT */ ||
        node.type === 9 /* IF */ ||
        node.type === 12 /* TEXT_CALL */) {
        return;
    }
    visitor(node);
    if (node.type === 5 /* INTERPOLATION */) {
        visitor(node.content);
    }
    else {
        node.children.forEach(function (n) { return walk(n, visitor); });
    }
}
function templateSimpleExpressionNodeVisitor(parseScriptFn) {
    return function (n) {
        if (n.type !== 4 /* SIMPLE_EXPRESSION */) {
            return;
        }
        var content = n.content;
        parseScriptFn(content);
    };
}
function parseFile(source, filename, parseScriptFn) {
    var _a = compiler_sfc_1.parse(source, {
        filename: filename,
    }), descriptor = _a.descriptor, errors = _a.errors;
    if (errors.length) {
        throw errors[0];
    }
    var script = descriptor.script, template = descriptor.template;
    if (template) {
        walk(template.ast, templateSimpleExpressionNodeVisitor(parseScriptFn));
    }
    if (script) {
        parseScriptFn(script.content);
    }
}
exports.parseFile = parseFile;
