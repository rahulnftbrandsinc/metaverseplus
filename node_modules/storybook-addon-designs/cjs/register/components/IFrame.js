"use strict";
var __makeTemplateObject = (this && this.__makeTemplateObject) || function (cooked, raw) {
    if (Object.defineProperty) { Object.defineProperty(cooked, "raw", { value: raw }); } else { cooked.raw = raw; }
    return cooked;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.IFrame = void 0;
/** @jsx jsx */
var react_1 = require("react");
var theming_1 = require("@storybook/theming");
var components_1 = require("@storybook/components");
exports.IFrame = function (_a) {
    var config = _a.config, _b = _a.defer, defer = _b === void 0 ? false : _b;
    var _c = react_1.useState(defer ? undefined : config.url), url = _c[0], setUrl = _c[1];
    // Defer loading iframe URL.
    // Some sites (e.g. Figma) detects Fullscreen API capability on
    // initial load. This is quite common implementation. But in our usage,
    // it seems that React hold the created <iframe> element when update,
    // and it causes "outdated Fullscreen capability" problem.
    // This might be a browser bug that "`fullscreenEnabled` property does not
    // updated" but I'm not sure what the correct behavior (I couldn't see the
    // statement in the Fulscreen API spec).
    // This side-effect delays the loading of an iframe contents by one frame to
    // make sure the contents gets updated attributes.
    // https://github.com/pocka/storybook-addon-designs/issues/77
    react_1.useEffect(function () {
        if (!defer) {
            return;
        }
        var handle = requestAnimationFrame(function () {
            setUrl(config.url);
        });
        return function () { return cancelAnimationFrame(handle); };
    }, [defer, config.url]);
    return (theming_1.jsx("div", { css: $container },
        theming_1.jsx(components_1.Placeholder, { css: $loading }, "Loading..."),
        theming_1.jsx("iframe", { css: $iframe, src: url, allowFullScreen: config.allowFullscreen })));
};
exports.default = exports.IFrame;
var $container = theming_1.css(templateObject_1 || (templateObject_1 = __makeTemplateObject(["\n  position: absolute;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  left: 0;\n\n  overflow: hidden;\n"], ["\n  position: absolute;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  left: 0;\n\n  overflow: hidden;\n"])));
var $loading = theming_1.css(templateObject_2 || (templateObject_2 = __makeTemplateObject(["\n  position: absolute;\n  top: 50%;\n  left: 50%;\n\n  transform: translate(-50%, -50%);\n"], ["\n  position: absolute;\n  top: 50%;\n  left: 50%;\n\n  transform: translate(-50%, -50%);\n"])));
var $iframe = theming_1.css(templateObject_3 || (templateObject_3 = __makeTemplateObject(["\n  position: relative;\n  width: 100%;\n  height: 100%;\n  border: none;\n\n  z-index: 1;\n"], ["\n  position: relative;\n  width: 100%;\n  height: 100%;\n  border: none;\n\n  z-index: 1;\n"])));
var templateObject_1, templateObject_2, templateObject_3;
