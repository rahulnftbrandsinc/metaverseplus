"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Wrapper = void 0;
/** @jsx jsx */
var react_1 = require("react");
var theming_1 = require("@storybook/theming");
var core_events_1 = require("@storybook/core-events");
var addon_1 = require("../../addon");
var Wrapper_1 = require("../components/Wrapper");
exports.Wrapper = function (_a) {
    var active = _a.active, api = _a.api, channel = _a.channel;
    var _b = react_1.useState(), config = _b[0], setConfig = _b[1];
    var _c = react_1.useState(), storyId = _c[0], changeStory = _c[1];
    react_1.useEffect(function () {
        var onStoryChanged = function (id) {
            changeStory(id);
            var cfg = api.getParameters(id, addon_1.ParameterName);
            setConfig(function (prev) { return (cfg !== prev ? cfg : prev); });
        };
        channel.on(addon_1.Events.UpdateConfig, setConfig);
        channel.on(core_events_1.STORY_CHANGED, onStoryChanged);
        return function () {
            channel.removeListener(addon_1.Events.UpdateConfig, setConfig);
            channel.removeListener(core_events_1.STORY_CHANGED, onStoryChanged);
        };
    }, []);
    if (!active) {
        return null;
    }
    return theming_1.jsx(Wrapper_1.Wrapper, { key: storyId, config: config });
};
exports.default = exports.Wrapper;
