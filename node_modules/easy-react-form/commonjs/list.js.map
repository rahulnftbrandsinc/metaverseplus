{"version":3,"sources":["../source/list.js"],"names":["List_","props","context","List","onReset","setState","getInitialItemsState","getFieldName","i","name","Error","onRegisterField","firstFieldName","add","state","items","itemsCounter","concat","focus","remove","filter","_","map","func","onRegisterList","count","initialValues","createIndexArray","length","getInitialItems","children","listContext","React","Component","propTypes","PropTypes","string","isRequired","number","object","defaultProps","ListContext","size","array","Array","listContextPropType","shape"],"mappings":"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","file":"list.js","sourcesContent":["import React from 'react'\r\nimport PropTypes from 'prop-types'\r\nimport createContext from 'create-react-context'\r\n\r\nimport { Context } from './form'\r\nimport { getFieldName } from './plugins/ListPlugin.utility'\r\n\r\nexport default function List_(props) {\r\n\treturn (\r\n\t\t<Context.Consumer>\r\n\t\t\t{context => (\r\n\t\t\t\t<List {...props} context={context}/>\r\n\t\t\t)}\r\n\t\t</Context.Consumer>\r\n\t)\r\n}\r\n\r\nclass List extends React.Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props)\r\n\t\tthis.state = {\r\n\t\t\tcontext: {\r\n\t\t\t\tgetFieldName: this.getFieldName,\r\n\t\t\t\tonRegisterField: this.onRegisterField\r\n\t\t\t},\r\n\t\t\t...this.getInitialItemsState()\r\n\t\t}\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tconst { name, context } = this.props\r\n\t\tcontext.onRegisterList(name, {\r\n\t\t\tonReset: this.onReset\r\n\t\t})\r\n\t}\r\n\r\n\tonReset = () => {\r\n\t\tthis.setState(this.getInitialItemsState())\r\n\t}\r\n\r\n\tgetInitialItems() {\r\n\t\tconst { context, name, count } = this.props\r\n\t\tif (context.initialValues[name]) {\r\n\t\t\treturn createIndexArray(context.initialValues[name].length)\r\n\t\t}\r\n\t\treturn createIndexArray(count)\r\n\t}\r\n\r\n\tgetInitialItemsState() {\r\n\t\tconst items = this.getInitialItems()\r\n\t\treturn {\r\n\t\t\titems,\r\n\t\t\titemsCounter: items.length\r\n\t\t}\r\n\t}\r\n\r\n\tgetFieldName = (i, name) => {\r\n\t\tif (typeof i !== 'number') {\r\n\t\t\tthrow new Error('Each `<Feild/>` in a `<List/>` must have an `i` property')\r\n\t\t}\r\n\t\treturn getFieldName(this.props.name, i, name)\r\n\t}\r\n\r\n\tonRegisterField = (name) => {\r\n\t\tif (!this.firstFieldName) {\r\n\t\t\tthis.firstFieldName = name\r\n\t\t}\r\n\t}\r\n\r\n\tadd = () => {\r\n\t\tconst { context } = this.props\r\n\t\tconst { items, itemsCounter } = this.state\r\n\t\tthis.setState({\r\n\t\t\titemsCounter: itemsCounter + 1,\r\n\t\t\titems: items.concat([itemsCounter])\r\n\t\t}, () => {\r\n\t\t\tconst { name } = this.props\r\n\t\t\tif (this.firstFieldName) {\r\n\t\t\t\tcontext.focus(`${name}:${itemsCounter}:${this.firstFieldName}`)\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tremove = (i) => {\r\n\t\tconst { items } = this.state\r\n\t\tthis.setState({\r\n\t\t\titems: items.filter(_ => _ !== i)\r\n\t\t})\r\n\t}\r\n\r\n\tmap = (func) => {\r\n\t\tconst { items } = this.state\r\n\t\treturn items.map(i => func(i))\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst { children } = this.props\r\n\t\tconst { context: listContext } = this.state\r\n\t\treturn (\r\n\t\t\t<Context.Consumer>\r\n\t\t\t\t{context => (\r\n\t\t\t\t\t<ListContext.Provider value={listContext}>\r\n\t\t\t\t\t\t{children({\r\n\t\t\t\t\t\t\tmap: this.map,\r\n\t\t\t\t\t\t\tadd: this.add,\r\n\t\t\t\t\t\t\tremove: this.remove\r\n\t\t\t\t\t\t})}\r\n\t\t\t\t\t</ListContext.Provider>\r\n\t\t\t\t)}\r\n\t\t\t</Context.Consumer>\r\n\t\t)\r\n\t}\r\n}\r\n\r\nList.propTypes = {\r\n\tname: PropTypes.string.isRequired,\r\n\tcount: PropTypes.number.isRequired,\r\n\tcontext: PropTypes.object.isRequired,\r\n\tchildren: PropTypes.func.isRequired\r\n}\r\n\r\nList.defaultProps = {\r\n\tcount: 1\r\n}\r\n\r\nexport const ListContext = createContext()\r\n\r\nfunction createIndexArray(size) {\r\n\tconst array = new Array(size)\r\n\tlet i = 0\r\n\twhile (i < size) {\r\n\t\tarray[i] = i\r\n\t\ti++\r\n\t}\r\n\treturn array\r\n}\r\n\r\nexport const listContextPropType = PropTypes.shape({\r\n\tgetFieldName: PropTypes.func.isRequired,\r\n\tonRegisterField: PropTypes.func.isRequired\r\n})"]}