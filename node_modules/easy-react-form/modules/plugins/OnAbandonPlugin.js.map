{"version":3,"sources":["../../source/plugins/OnAbandonPlugin.js"],"names":["OnAbandonPlugin","getProps","getState","onLeaveForm","onAbandon","submitted","field","latestFocusedField","values","onReset","window","addEventListener","removeEventListener","undefined"],"mappings":";;;;;;;;;;IAAqBA,e;AACpB,0BAAYC,QAAZ,EAAsBC,QAAtB,EAAgC;AAAA;;AAAA;;AAAA,OAyBhCC,WAzBgC,GAyBlB,YAAM;AAAA,mBACG,MAAKF,QAAL,EADH;AAAA,OACXG,SADW,aACXA,SADW;;AAGnB;AACA;;;AACA,OAAI,MAAKC,SAAT,EAAoB;AACnB;AACA;;AAED;AACA,OAAMC,QAAQ,MAAKJ,QAAL,GAAgBK,kBAA9B;;AAEA;AACA;AACA,OAAI,CAACD,KAAL,EAAY;AACX;AACA;;AAEDF,aAAUE,KAAV,EAAiB,MAAKJ,QAAL,GAAgBM,MAAhB,CAAuBF,KAAvB,CAAjB;AACA,GA5C+B;;AAC/B,OAAKL,QAAL,GAAgBA,QAAhB;AACA,OAAKC,QAAL,GAAgBA,QAAhB;AACA,OAAKO,OAAL;AACA;;;;4BAES;AAAA,oBACa,KAAKR,QAAL,EADb;AAAA,OACDG,SADC,cACDA,SADC;;AAET,OAAI,CAACA,SAAL,EAAgB;AACf;AACA;AACD;AACA;AACAM,UAAOC,gBAAP,CAAwB,cAAxB,EAAwC,KAAKR,WAA7C;AACA;;;8BAEW;AAAA,oBACW,KAAKF,QAAL,EADX;AAAA,OACHG,SADG,cACHA,SADG;;AAEX,OAAI,CAACA,SAAL,EAAgB;AACf;AACA;AACDM,UAAOE,mBAAP,CAA2B,cAA3B,EAA2C,KAAKT,WAAhD;AACA,QAAKA,WAAL;AACA;;;kCAuBe;AACf,QAAKE,SAAL,GAAiB,IAAjB;AACA;;;4BAES;AACT,QAAKA,SAAL,GAAiBQ,SAAjB;AACA;;;;;;kBArDmBb,e","file":"OnAbandonPlugin.js","sourcesContent":["export default class OnAbandonPlugin {\r\n\tconstructor(getProps, getState) {\r\n\t\tthis.getProps = getProps\r\n\t\tthis.getState = getState\r\n\t\tthis.onReset()\r\n\t}\r\n\r\n\tonMount() {\r\n\t\tconst { onAbandon } = this.getProps()\r\n\t\tif (!onAbandon) {\r\n\t\t\treturn\r\n\t\t}\r\n\t\t// Report abandoned form on page close.\r\n\t\t// (though it might not have time sufficient to report anything)\r\n\t\twindow.addEventListener('beforeunload', this.onLeaveForm)\r\n\t}\r\n\r\n\tonUnmount() {\r\n\t\tconst { onAbandon } = this.getProps()\r\n\t\tif (!onAbandon) {\r\n\t\t\treturn\r\n\t\t}\r\n\t\twindow.removeEventListener('beforeunload', this.onLeaveForm)\r\n\t\tthis.onLeaveForm()\r\n\t}\r\n\r\n\tonLeaveForm = () => {\r\n\t\tconst { onAbandon } = this.getProps()\r\n\r\n\t\t// If the form is already submitted\r\n\t\t// then it's not abandoned.\r\n\t\tif (this.submitted) {\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\t// Get the latest focused form field\r\n\t\tconst field = this.getState().latestFocusedField\r\n\r\n\t\t// If no form field was ever focused\r\n\t\t// then the form is not being abandoned.\r\n\t\tif (!field) {\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tonAbandon(field, this.getState().values[field])\r\n\t}\r\n\r\n\tonAfterSubmit() {\r\n\t\tthis.submitted = true\r\n\t}\r\n\r\n\tonReset() {\r\n\t\tthis.submitted = undefined\r\n\t}\r\n}"]}