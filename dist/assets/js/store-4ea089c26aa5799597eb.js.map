{"version":3,"sources":["webpack:///./node_modules/jsonschema/lib/index.js","webpack:///./node_modules/jsonschema/lib/helpers.js","webpack:///./node_modules/jwt-decode/lib/index.js","webpack:///./node_modules/jsonschema/lib/scan.js","webpack:///./node_modules/js-cookie/src/js.cookie.js","webpack:///./node_modules/event-target-shim/dist/event-target-shim.mjs","webpack:///./node_modules/jsonschema/lib/validator.js","webpack:///./node_modules/jsonschema/lib/attribute.js","webpack:///./node_modules/jwt-decode/lib/base64_url_decode.js","webpack:///./node_modules/jwt-decode/lib/atob.js","webpack:///./node_modules/phoenix/js/phoenix.js"],"names":["Validator","module","exports","ValidatorResult","ValidationError","SchemaError","SchemaScanResult","scan","validate","instance","schema","options","uri","message","propertyPath","name","argument","this","property","id","stack","toString","prototype","ctx","errors","throwError","disableFormat","stringizer","v","i","addError","detail","err","Error","push","importErrors","res","validatorType","Array","apply","map","join","Object","defineProperty","get","length","msg","call","captureStackTrace","create","constructor","value","enumerable","SchemaContext","base","schemas","resolve","target","makeChild","propertyName","undefined","makeSuffix","FORMAT_REGEXPS","input","parseFloat","parseInt","isNaN","result","RegExp","e","regexp","regex","pattern","ipv4","isFormat","format","validator","test","customFormats","key","match","JSON","stringify","deepMerger","dst","deepMerge","indexOf","copyist","src","copyistWithDeepMerge","array","isArray","concat","forEach","bind","keys","pathEncoder","encodeURIComponent","replace","deepCompareStrict","a","b","every","aKeys","bKeys","objectGetPath","o","s","k","parts","split","slice","shift","n","decodeURIComponent","encodePath","getDecimalPlaces","number","decimalPlaces","Number","decimalParts","base64_url_decode","InvalidTokenError","token","pos","header","parse","urilib","helpers","found","ref","scanSchema","baseuri","$ref","resolvedUri","ourBase","substring","scanArray","items","extends","additionalItems","scanObject","properties","additionalProperties","definitions","patternProperties","dependencies","disallow","allOf","anyOf","oneOf","not","p","factory","OldCookies","window","Cookies","api","noConflict","extend","arguments","attributes","init","converter","document","path","defaults","expires","Date","setMilliseconds","getMilliseconds","toUTCString","write","String","escape","stringifiedAttributes","attributeName","cookie","cookies","rdecode","json","charAt","read","set","getJSON","remove","withConverter","privateData","WeakMap","wrappers","pd","event","retv","console","assert","Event","eventTarget","eventPhase","currentTarget","canceled","stopped","passiveListener","timeStamp","now","defineRedirectDescriptor","configurable","defineCallDescriptor","getWrapper","proto","wrapper","BaseEvent","CustomEvent","writable","isFunc","getOwnPropertyDescriptor","defineWrapper","getPrototypeOf","isStopped","setPassiveListener","type","data","stopPropagation","stopImmediatePropagation","Boolean","bubbles","cancelable","preventDefault","warn","composed","setPrototypeOf","listenersMap","isObject","x","getListeners","listeners","TypeError","defineEventAttribute","eventTargetPrototype","eventName","node","listenerType","listener","next","prev","delete","newNode","passive","once","defineEventAttributeDescriptor","defineCustomEventTarget","eventNames","CustomEventTarget","EventTarget","types","Map","optionsIsObj","capture","wrappedEvent","wrapEvent","error","handleEvent","setEventPhase","setCurrentTarget","defaultPrevented","attribute","unresolvedRefs","validators","shouldResolve","addSchema","self","ourUri","filter","addSubSchemaArray","addSubSchema","addSubSchemaObject","setSchemas","getSchema","urn","sch","validateSchema","switchSchema","schemaobj","schemaTraverser","superResolve","resolved","subctx","subschema","skipAttributes","ignoreProperties","validatorErr","allowUnknownAttributes","rewrite","parsed","fragment","hash","substr","testType","string","isFinite","integer","boolean","date","any","object","testSchemaNoThrow","callback","valid","Function","testAdditionalProperty","preValidateProperty","some","list","inner","title","nestedErrors","count","prop","hasOwnProperty","minProperties","maxProperties","minimum","exclusiveMinimum","maximum","exclusiveMaximum","validateMultipleOfOrDivisbleBy","validationType","errorMessage","validationArgument","instanceDecimals","divisorDecimals","maxDecimals","Math","max","multiplier","pow","round","testArrays","j","len","multipleOf","divisibleBy","required","minLength","hsp","maxLength","minItems","maxItems","uniqueItems","dep","childContext","notTypes","schemaId","atob","str","output","m","code","charCodeAt","toUpperCase","b64DecodeUnicode","InvalidCharacterError","bs","buffer","bc","idx","fromCharCode","globalSelf","phxWindow","global","SOCKET_STATES","CHANNEL_STATES","CHANNEL_EVENTS","CHANNEL_LIFECYCLE_EVENTS","TRANSPORTS","closure","Push","channel","payload","timeout","receivedResp","timeoutTimer","recHooks","sent","reset","send","hasReceived","startTimeout","socket","topic","join_ref","joinRef","status","response","cancelRefEvent","refEvent","h","off","clearTimeout","cancelTimeout","makeRef","replyEventName","on","matchReceive","setTimeout","trigger","Channel","params","state","bindings","bindingRef","joinedOnce","joinPush","pushBuffer","rejoinTimer","Timer","isConnected","rejoin","rejoinAfterMs","onError","onOpen","isErrored","receive","pushEvent","scheduleTimeout","onClose","hasLogger","log","reason","isJoining","isJoined","canPush","leavePush","isLifecycleEvent","resend","isLeaving","sendJoin","handledPayload","onMessage","Serializer","rawPayload","Socket","endPoint","opts","stateChangeCallbacks","open","close","channels","sendBuffer","transport","WebSocket","LongPoll","defaultEncoder","encode","defaultDecoder","decode","closeWasClean","unloaded","binaryType","addEventListener","conn","abnormalClose","heartbeatIntervalMs","tries","reconnectAfterMs","logger","longpollerTimeout","heartbeatTimer","pendingHeartbeatRef","reconnectTimer","teardown","connect","location","protocol","Ajax","appendParams","vsn","host","endPointURL","onopen","onConnOpen","onerror","onConnError","onmessage","onConnMessage","onclose","onConnClose","kind","flushSendBuffer","resetHeartbeat","skipHeartbeat","clearInterval","setInterval","sendHeartbeat","triggerChanError","isClosed","readyState","connectionState","c","chanParams","chan","reliable","newRef","rawMessage","isMember","pollEndpoint","normalizeEndpoint","poll","closeAndRetry","request","endpointURL","ontimeout","resp","messages","body","method","accept","XDomainRequest","req","xdomainRequest","XMLHttpRequest","ActiveXObject","xhrRequest","onload","parseJSON","responseText","onprogress","setRequestHeader","onreadystatechange","states","complete","obj","parentKey","queryStr","paramKey","paramVal","serialize","url","prefix","Presence","events","diff","pendingDiffs","caller","onJoin","onLeave","onSync","newState","syncState","syncDiff","inPendingSyncState","by","currentState","clone","joins","leaves","presence","newPresence","currentPresence","newRefs","metas","phx_ref","curRefs","joinedMetas","leftMetas","joinedRefs","curMetas","unshift","leftPresence","refsToRemove","presences","chooser","pres","func","getOwnPropertyNames","timerCalc","timer"],"mappings":"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","file":"assets/js/store-4ea089c26aa5799597eb.js","sourcesContent":["'use strict';\n\nvar Validator = module.exports.Validator = require('./validator');\n\nmodule.exports.ValidatorResult = require('./helpers').ValidatorResult;\nmodule.exports.ValidationError = require('./helpers').ValidationError;\nmodule.exports.SchemaError = require('./helpers').SchemaError;\nmodule.exports.SchemaScanResult = require('./scan').SchemaScanResult;\nmodule.exports.scan = require('./scan').scan;\n\nmodule.exports.validate = function (instance, schema, options) {\n  var v = new Validator();\n  return v.validate(instance, schema, options);\n};\n","'use strict';\n\nvar uri = require('url');\n\nvar ValidationError = exports.ValidationError = function ValidationError (message, instance, schema, propertyPath, name, argument) {\n  if (propertyPath) {\n    this.property = propertyPath;\n  }\n  if (message) {\n    this.message = message;\n  }\n  if (schema) {\n    if (schema.id) {\n      this.schema = schema.id;\n    } else {\n      this.schema = schema;\n    }\n  }\n  if (instance) {\n    this.instance = instance;\n  }\n  this.name = name;\n  this.argument = argument;\n  this.stack = this.toString();\n};\n\nValidationError.prototype.toString = function toString() {\n  return this.property + ' ' + this.message;\n};\n\nvar ValidatorResult = exports.ValidatorResult = function ValidatorResult(instance, schema, options, ctx) {\n  this.instance = instance;\n  this.schema = schema;\n  this.propertyPath = ctx.propertyPath;\n  this.errors = [];\n  this.throwError = options && options.throwError;\n  this.disableFormat = options && options.disableFormat === true;\n};\n\nValidatorResult.prototype.addError = function addError(detail) {\n  var err;\n  if (typeof detail == 'string') {\n    err = new ValidationError(detail, this.instance, this.schema, this.propertyPath);\n  } else {\n    if (!detail) throw new Error('Missing error detail');\n    if (!detail.message) throw new Error('Missing error message');\n    if (!detail.name) throw new Error('Missing validator type');\n    err = new ValidationError(detail.message, this.instance, this.schema, this.propertyPath, detail.name, detail.argument);\n  }\n\n  if (this.throwError) {\n    throw err;\n  }\n  this.errors.push(err);\n  return err;\n};\n\nValidatorResult.prototype.importErrors = function importErrors(res) {\n  if (typeof res == 'string' || (res && res.validatorType)) {\n    this.addError(res);\n  } else if (res && res.errors) {\n    Array.prototype.push.apply(this.errors, res.errors);\n  }\n};\n\nfunction stringizer (v,i){\n  return i+': '+v.toString()+'\\n';\n}\nValidatorResult.prototype.toString = function toString(res) {\n  return this.errors.map(stringizer).join('');\n};\n\nObject.defineProperty(ValidatorResult.prototype, \"valid\", { get: function() {\n  return !this.errors.length;\n} });\n\n/**\n * Describes a problem with a Schema which prevents validation of an instance\n * @name SchemaError\n * @constructor\n */\nvar SchemaError = exports.SchemaError = function SchemaError (msg, schema) {\n  this.message = msg;\n  this.schema = schema;\n  Error.call(this, msg);\n  Error.captureStackTrace(this, SchemaError);\n};\nSchemaError.prototype = Object.create(Error.prototype,\n  { constructor: {value: SchemaError, enumerable: false}\n  , name: {value: 'SchemaError', enumerable: false}\n  });\n\nvar SchemaContext = exports.SchemaContext = function SchemaContext (schema, options, propertyPath, base, schemas) {\n  this.schema = schema;\n  this.options = options;\n  this.propertyPath = propertyPath;\n  this.base = base;\n  this.schemas = schemas;\n};\n\nSchemaContext.prototype.resolve = function resolve (target) {\n  return uri.resolve(this.base, target);\n};\n\nSchemaContext.prototype.makeChild = function makeChild(schema, propertyName){\n  var propertyPath = (propertyName===undefined) ? this.propertyPath : this.propertyPath+makeSuffix(propertyName);\n  var base = uri.resolve(this.base, schema.id||'');\n  var ctx = new SchemaContext(schema, this.options, propertyPath, base, Object.create(this.schemas));\n  if(schema.id && !ctx.schemas[base]){\n    ctx.schemas[base] = schema;\n  }\n  return ctx;\n}\n\nvar FORMAT_REGEXPS = exports.FORMAT_REGEXPS = {\n  'date-time': /^\\d{4}-(?:0[0-9]{1}|1[0-2]{1})-(3[01]|0[1-9]|[12][0-9])[tT ](2[0-4]|[01][0-9]):([0-5][0-9]):(60|[0-5][0-9])(\\.\\d+)?([zZ]|[+-]([0-5][0-9]):(60|[0-5][0-9]))$/,\n  'date': /^\\d{4}-(?:0[0-9]{1}|1[0-2]{1})-(3[01]|0[1-9]|[12][0-9])$/,\n  'time': /^(2[0-4]|[01][0-9]):([0-5][0-9]):(60|[0-5][0-9])$/,\n\n  'email': /^(?:[\\w\\!\\#\\$\\%\\&\\'\\*\\+\\-\\/\\=\\?\\^\\`\\{\\|\\}\\~]+\\.)*[\\w\\!\\#\\$\\%\\&\\'\\*\\+\\-\\/\\=\\?\\^\\`\\{\\|\\}\\~]+@(?:(?:(?:[a-zA-Z0-9](?:[a-zA-Z0-9\\-](?!\\.)){0,61}[a-zA-Z0-9]?\\.)+[a-zA-Z0-9](?:[a-zA-Z0-9\\-](?!$)){0,61}[a-zA-Z0-9]?)|(?:\\[(?:(?:[01]?\\d{1,2}|2[0-4]\\d|25[0-5])\\.){3}(?:[01]?\\d{1,2}|2[0-4]\\d|25[0-5])\\]))$/,\n  'ip-address': /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,\n  'ipv6': /^\\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:)))(%.+)?\\s*$/,\n  'uri': /^[a-zA-Z][a-zA-Z0-9+-.]*:[^\\s]*$/,\n\n  'color': /^(#?([0-9A-Fa-f]{3}){1,2}\\b|aqua|black|blue|fuchsia|gray|green|lime|maroon|navy|olive|orange|purple|red|silver|teal|white|yellow|(rgb\\(\\s*\\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\b\\s*,\\s*\\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\b\\s*,\\s*\\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\b\\s*\\))|(rgb\\(\\s*(\\d?\\d%|100%)+\\s*,\\s*(\\d?\\d%|100%)+\\s*,\\s*(\\d?\\d%|100%)+\\s*\\)))$/,\n\n  // hostname regex from: http://stackoverflow.com/a/1420225/5628\n  'hostname': /^(?=.{1,255}$)[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?(?:\\.[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?)*\\.?$/,\n  'host-name': /^(?=.{1,255}$)[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?(?:\\.[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?)*\\.?$/,\n\n  'alpha': /^[a-zA-Z]+$/,\n  'alphanumeric': /^[a-zA-Z0-9]+$/,\n  'utc-millisec': function (input) {\n    return (typeof input === 'string') && parseFloat(input) === parseInt(input, 10) && !isNaN(input);\n  },\n  'regex': function (input) {\n    var result = true;\n    try {\n      new RegExp(input);\n    } catch (e) {\n      result = false;\n    }\n    return result;\n  },\n  'style': /\\s*(.+?):\\s*([^;]+);?/g,\n  'phone': /^\\+(?:[0-9] ?){6,14}[0-9]$/\n};\n\nFORMAT_REGEXPS.regexp = FORMAT_REGEXPS.regex;\nFORMAT_REGEXPS.pattern = FORMAT_REGEXPS.regex;\nFORMAT_REGEXPS.ipv4 = FORMAT_REGEXPS['ip-address'];\n\nexports.isFormat = function isFormat (input, format, validator) {\n  if (typeof input === 'string' && FORMAT_REGEXPS[format] !== undefined) {\n    if (FORMAT_REGEXPS[format] instanceof RegExp) {\n      return FORMAT_REGEXPS[format].test(input);\n    }\n    if (typeof FORMAT_REGEXPS[format] === 'function') {\n      return FORMAT_REGEXPS[format](input);\n    }\n  } else if (validator && validator.customFormats &&\n      typeof validator.customFormats[format] === 'function') {\n    return validator.customFormats[format](input);\n  }\n  return true;\n};\n\nvar makeSuffix = exports.makeSuffix = function makeSuffix (key) {\n  key = key.toString();\n  // This function could be capable of outputting valid a ECMAScript string, but the\n  // resulting code for testing which form to use would be tens of thousands of characters long\n  // That means this will use the name form for some illegal forms\n  if (!key.match(/[.\\s\\[\\]]/) && !key.match(/^[\\d]/)) {\n    return '.' + key;\n  }\n  if (key.match(/^\\d+$/)) {\n    return '[' + key + ']';\n  }\n  return '[' + JSON.stringify(key) + ']';\n};\n\nexports.deepCompareStrict = function deepCompareStrict (a, b) {\n  if (typeof a !== typeof b) {\n    return false;\n  }\n  if (a instanceof Array) {\n    if (!(b instanceof Array)) {\n      return false;\n    }\n    if (a.length !== b.length) {\n      return false;\n    }\n    return a.every(function (v, i) {\n      return deepCompareStrict(a[i], b[i]);\n    });\n  }\n  if (typeof a === 'object') {\n    if (!a || !b) {\n      return a === b;\n    }\n    var aKeys = Object.keys(a);\n    var bKeys = Object.keys(b);\n    if (aKeys.length !== bKeys.length) {\n      return false;\n    }\n    return aKeys.every(function (v) {\n      return deepCompareStrict(a[v], b[v]);\n    });\n  }\n  return a === b;\n};\n\nfunction deepMerger (target, dst, e, i) {\n  if (typeof e === 'object') {\n    dst[i] = deepMerge(target[i], e)\n  } else {\n    if (target.indexOf(e) === -1) {\n      dst.push(e)\n    }\n  }\n}\n\nfunction copyist (src, dst, key) {\n  dst[key] = src[key];\n}\n\nfunction copyistWithDeepMerge (target, src, dst, key) {\n  if (typeof src[key] !== 'object' || !src[key]) {\n    dst[key] = src[key];\n  }\n  else {\n    if (!target[key]) {\n      dst[key] = src[key];\n    } else {\n      dst[key] = deepMerge(target[key], src[key])\n    }\n  }\n}\n\nfunction deepMerge (target, src) {\n  var array = Array.isArray(src);\n  var dst = array && [] || {};\n\n  if (array) {\n    target = target || [];\n    dst = dst.concat(target);\n    src.forEach(deepMerger.bind(null, target, dst));\n  } else {\n    if (target && typeof target === 'object') {\n      Object.keys(target).forEach(copyist.bind(null, target, dst));\n    }\n    Object.keys(src).forEach(copyistWithDeepMerge.bind(null, target, src, dst));\n  }\n\n  return dst;\n};\n\nmodule.exports.deepMerge = deepMerge;\n\n/**\n * Validates instance against the provided schema\n * Implements URI+JSON Pointer encoding, e.g. \"%7e\"=\"~0\"=>\"~\", \"~1\"=\"%2f\"=>\"/\"\n * @param o\n * @param s The path to walk o along\n * @return any\n */\nexports.objectGetPath = function objectGetPath(o, s) {\n  var parts = s.split('/').slice(1);\n  var k;\n  while (typeof (k=parts.shift()) == 'string') {\n    var n = decodeURIComponent(k.replace(/~0/,'~').replace(/~1/g,'/'));\n    if (!(n in o)) return;\n    o = o[n];\n  }\n  return o;\n};\n\nfunction pathEncoder (v) {\n  return '/'+encodeURIComponent(v).replace(/~/g,'%7E');\n}\n/**\n * Accept an Array of property names and return a JSON Pointer URI fragment\n * @param Array a\n * @return {String}\n */\nexports.encodePath = function encodePointer(a){\n\t// ~ must be encoded explicitly because hacks\n\t// the slash is encoded by encodeURIComponent\n\treturn a.map(pathEncoder).join('');\n};\n\n\n/**\n * Calculate the number of decimal places a number uses\n * We need this to get correct results out of multipleOf and divisibleBy\n * when either figure is has decimal places, due to IEEE-754 float issues.\n * @param number\n * @returns {number}\n */\nexports.getDecimalPlaces = function getDecimalPlaces(number) {\n\n  var decimalPlaces = 0;\n  if (isNaN(number)) return decimalPlaces;\n\n  if (typeof number !== 'number') {\n    number = Number(number);\n  }\n\n  var parts = number.toString().split('e');\n  if (parts.length === 2) {\n    if (parts[1][0] !== '-') {\n      return decimalPlaces;\n    } else {\n      decimalPlaces = Number(parts[1].slice(1));\n    }\n  }\n\n  var decimalParts = parts[0].split('.');\n  if (decimalParts.length === 2) {\n    decimalPlaces += decimalParts[1].length;\n  }\n\n  return decimalPlaces;\n};\n\n","'use strict';\n\nvar base64_url_decode = require('./base64_url_decode');\n\nfunction InvalidTokenError(message) {\n  this.message = message;\n}\n\nInvalidTokenError.prototype = new Error();\nInvalidTokenError.prototype.name = 'InvalidTokenError';\n\nmodule.exports = function (token,options) {\n  if (typeof token !== 'string') {\n    throw new InvalidTokenError('Invalid token specified');\n  }\n\n  options = options || {};\n  var pos = options.header === true ? 0 : 1;\n  try {\n    return JSON.parse(base64_url_decode(token.split('.')[pos]));\n  } catch (e) {\n    throw new InvalidTokenError('Invalid token specified: ' + e.message);\n  }\n};\n\nmodule.exports.InvalidTokenError = InvalidTokenError;\n","\nvar urilib = require('url');\nvar helpers = require('./helpers');\n\nmodule.exports.SchemaScanResult = SchemaScanResult;\nfunction SchemaScanResult(found, ref){\n  this.id = found;\n  this.ref = ref;\n}\n\n/**\n * Adds a schema with a certain urn to the Validator instance.\n * @param string uri\n * @param object schema\n * @return {Object}\n */\nmodule.exports.scan = function scan(base, schema){\n  function scanSchema(baseuri, schema){\n    if(!schema || typeof schema!='object') return;\n    // Mark all referenced schemas so we can tell later which schemas are referred to, but never defined\n    if(schema.$ref){\n      var resolvedUri = urilib.resolve(baseuri, schema.$ref);\n      ref[resolvedUri] = ref[resolvedUri] ? ref[resolvedUri]+1 : 0;\n      return;\n    }\n    var ourBase = schema.id ? urilib.resolve(baseuri, schema.id) : baseuri;\n    if (ourBase) {\n      // If there's no fragment, append an empty one\n      if(ourBase.indexOf('#')<0) ourBase += '#';\n      if(found[ourBase]){\n        if(!helpers.deepCompareStrict(found[ourBase], schema)){\n          throw new Error('Schema <'+schema+'> already exists with different definition');\n        }\n        return found[ourBase];\n      }\n      found[ourBase] = schema;\n      // strip trailing fragment\n      if(ourBase[ourBase.length-1]=='#'){\n        found[ourBase.substring(0, ourBase.length-1)] = schema;\n      }\n    }\n    scanArray(ourBase+'/items', ((schema.items instanceof Array)?schema.items:[schema.items]));\n    scanArray(ourBase+'/extends', ((schema.extends instanceof Array)?schema.extends:[schema.extends]));\n    scanSchema(ourBase+'/additionalItems', schema.additionalItems);\n    scanObject(ourBase+'/properties', schema.properties);\n    scanSchema(ourBase+'/additionalProperties', schema.additionalProperties);\n    scanObject(ourBase+'/definitions', schema.definitions);\n    scanObject(ourBase+'/patternProperties', schema.patternProperties);\n    scanObject(ourBase+'/dependencies', schema.dependencies);\n    scanArray(ourBase+'/disallow', schema.disallow);\n    scanArray(ourBase+'/allOf', schema.allOf);\n    scanArray(ourBase+'/anyOf', schema.anyOf);\n    scanArray(ourBase+'/oneOf', schema.oneOf);\n    scanSchema(ourBase+'/not', schema.not);\n  }\n  function scanArray(baseuri, schemas){\n    if(!(schemas instanceof Array)) return;\n    for(var i=0; i<schemas.length; i++){\n      scanSchema(baseuri+'/'+i, schemas[i]);\n    }\n  }\n  function scanObject(baseuri, schemas){\n    if(!schemas || typeof schemas!='object') return;\n    for(var p in schemas){\n      scanSchema(baseuri+'/'+p, schemas[p]);\n    }\n  }\n\n  var found = {};\n  var ref = {};\n  var schemaUri = base;\n  scanSchema(base, schema);\n  return new SchemaScanResult(found, ref);\n}\n","/*!\n * JavaScript Cookie v2.2.0\n * https://github.com/js-cookie/js-cookie\n *\n * Copyright 2006, 2015 Klaus Hartl & Fagner Brack\n * Released under the MIT license\n */\n;(function (factory) {\n\tvar registeredInModuleLoader = false;\n\tif (typeof define === 'function' && define.amd) {\n\t\tdefine(factory);\n\t\tregisteredInModuleLoader = true;\n\t}\n\tif (typeof exports === 'object') {\n\t\tmodule.exports = factory();\n\t\tregisteredInModuleLoader = true;\n\t}\n\tif (!registeredInModuleLoader) {\n\t\tvar OldCookies = window.Cookies;\n\t\tvar api = window.Cookies = factory();\n\t\tapi.noConflict = function () {\n\t\t\twindow.Cookies = OldCookies;\n\t\t\treturn api;\n\t\t};\n\t}\n}(function () {\n\tfunction extend () {\n\t\tvar i = 0;\n\t\tvar result = {};\n\t\tfor (; i < arguments.length; i++) {\n\t\t\tvar attributes = arguments[ i ];\n\t\t\tfor (var key in attributes) {\n\t\t\t\tresult[key] = attributes[key];\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tfunction init (converter) {\n\t\tfunction api (key, value, attributes) {\n\t\t\tvar result;\n\t\t\tif (typeof document === 'undefined') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Write\n\n\t\t\tif (arguments.length > 1) {\n\t\t\t\tattributes = extend({\n\t\t\t\t\tpath: '/'\n\t\t\t\t}, api.defaults, attributes);\n\n\t\t\t\tif (typeof attributes.expires === 'number') {\n\t\t\t\t\tvar expires = new Date();\n\t\t\t\t\texpires.setMilliseconds(expires.getMilliseconds() + attributes.expires * 864e+5);\n\t\t\t\t\tattributes.expires = expires;\n\t\t\t\t}\n\n\t\t\t\t// We're using \"expires\" because \"max-age\" is not supported by IE\n\t\t\t\tattributes.expires = attributes.expires ? attributes.expires.toUTCString() : '';\n\n\t\t\t\ttry {\n\t\t\t\t\tresult = JSON.stringify(value);\n\t\t\t\t\tif (/^[\\{\\[]/.test(result)) {\n\t\t\t\t\t\tvalue = result;\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {}\n\n\t\t\t\tif (!converter.write) {\n\t\t\t\t\tvalue = encodeURIComponent(String(value))\n\t\t\t\t\t\t.replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g, decodeURIComponent);\n\t\t\t\t} else {\n\t\t\t\t\tvalue = converter.write(value, key);\n\t\t\t\t}\n\n\t\t\t\tkey = encodeURIComponent(String(key));\n\t\t\t\tkey = key.replace(/%(23|24|26|2B|5E|60|7C)/g, decodeURIComponent);\n\t\t\t\tkey = key.replace(/[\\(\\)]/g, escape);\n\n\t\t\t\tvar stringifiedAttributes = '';\n\n\t\t\t\tfor (var attributeName in attributes) {\n\t\t\t\t\tif (!attributes[attributeName]) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tstringifiedAttributes += '; ' + attributeName;\n\t\t\t\t\tif (attributes[attributeName] === true) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tstringifiedAttributes += '=' + attributes[attributeName];\n\t\t\t\t}\n\t\t\t\treturn (document.cookie = key + '=' + value + stringifiedAttributes);\n\t\t\t}\n\n\t\t\t// Read\n\n\t\t\tif (!key) {\n\t\t\t\tresult = {};\n\t\t\t}\n\n\t\t\t// To prevent the for loop in the first place assign an empty array\n\t\t\t// in case there are no cookies at all. Also prevents odd result when\n\t\t\t// calling \"get()\"\n\t\t\tvar cookies = document.cookie ? document.cookie.split('; ') : [];\n\t\t\tvar rdecode = /(%[0-9A-Z]{2})+/g;\n\t\t\tvar i = 0;\n\n\t\t\tfor (; i < cookies.length; i++) {\n\t\t\t\tvar parts = cookies[i].split('=');\n\t\t\t\tvar cookie = parts.slice(1).join('=');\n\n\t\t\t\tif (!this.json && cookie.charAt(0) === '\"') {\n\t\t\t\t\tcookie = cookie.slice(1, -1);\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tvar name = parts[0].replace(rdecode, decodeURIComponent);\n\t\t\t\t\tcookie = converter.read ?\n\t\t\t\t\t\tconverter.read(cookie, name) : converter(cookie, name) ||\n\t\t\t\t\t\tcookie.replace(rdecode, decodeURIComponent);\n\n\t\t\t\t\tif (this.json) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tcookie = JSON.parse(cookie);\n\t\t\t\t\t\t} catch (e) {}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (key === name) {\n\t\t\t\t\t\tresult = cookie;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!key) {\n\t\t\t\t\t\tresult[name] = cookie;\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {}\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}\n\n\t\tapi.set = api;\n\t\tapi.get = function (key) {\n\t\t\treturn api.call(api, key);\n\t\t};\n\t\tapi.getJSON = function () {\n\t\t\treturn api.apply({\n\t\t\t\tjson: true\n\t\t\t}, [].slice.call(arguments));\n\t\t};\n\t\tapi.defaults = {};\n\n\t\tapi.remove = function (key, attributes) {\n\t\t\tapi(key, '', extend(attributes, {\n\t\t\t\texpires: -1\n\t\t\t}));\n\t\t};\n\n\t\tapi.withConverter = init;\n\n\t\treturn api;\n\t}\n\n\treturn init(function () {});\n}));\n","/**\n * @author Toru Nagashima <https://github.com/mysticatea>\n * @copyright 2015 Toru Nagashima. All rights reserved.\n * See LICENSE file in root directory for full license.\n */\n/**\n * @typedef {object} PrivateData\n * @property {EventTarget} eventTarget The event target.\n * @property {{type:string}} event The original event object.\n * @property {number} eventPhase The current event phase.\n * @property {EventTarget|null} currentTarget The current event target.\n * @property {boolean} canceled The flag to prevent default.\n * @property {boolean} stopped The flag to stop propagation immediately.\n * @property {Function|null} passiveListener The listener if the current listener is passive. Otherwise this is null.\n * @property {number} timeStamp The unix time.\n * @private\n */\n\n/**\n * Private data for event wrappers.\n * @type {WeakMap<Event, PrivateData>}\n * @private\n */\nconst privateData = new WeakMap();\n\n/**\n * Cache for wrapper classes.\n * @type {WeakMap<Object, Function>}\n * @private\n */\nconst wrappers = new WeakMap();\n\n/**\n * Get private data.\n * @param {Event} event The event object to get private data.\n * @returns {PrivateData} The private data of the event.\n * @private\n */\nfunction pd(event) {\n    const retv = privateData.get(event);\n    console.assert(retv != null, \"'this' is expected an Event object, but got\", event);\n    return retv\n}\n\n/**\n * @see https://dom.spec.whatwg.org/#interface-event\n * @private\n */\n/**\n * The event wrapper.\n * @constructor\n * @param {EventTarget} eventTarget The event target of this dispatching.\n * @param {Event|{type:string}} event The original event to wrap.\n */\nfunction Event(eventTarget, event) {\n    privateData.set(this, {\n        eventTarget,\n        event,\n        eventPhase: 2,\n        currentTarget: eventTarget,\n        canceled: false,\n        stopped: false,\n        passiveListener: null,\n        timeStamp: event.timeStamp || Date.now(),\n    });\n\n    // https://heycam.github.io/webidl/#Unforgeable\n    Object.defineProperty(this, \"isTrusted\", { value: false, enumerable: true });\n\n    // Define accessors\n    const keys = Object.keys(event);\n    for (let i = 0; i < keys.length; ++i) {\n        const key = keys[i];\n        if (!(key in this)) {\n            Object.defineProperty(this, key, defineRedirectDescriptor(key));\n        }\n    }\n}\n\n// Should be enumerable, but class methods are not enumerable.\nEvent.prototype = {\n    /**\n     * The type of this event.\n     * @type {string}\n     */\n    get type() {\n        return pd(this).event.type\n    },\n\n    /**\n     * The target of this event.\n     * @type {EventTarget}\n     */\n    get target() {\n        return pd(this).eventTarget\n    },\n\n    /**\n     * The target of this event.\n     * @type {EventTarget}\n     */\n    get currentTarget() {\n        return pd(this).currentTarget\n    },\n\n    /**\n     * @returns {EventTarget[]} The composed path of this event.\n     */\n    composedPath() {\n        const currentTarget = pd(this).currentTarget;\n        if (currentTarget == null) {\n            return []\n        }\n        return [currentTarget]\n    },\n\n    /**\n     * Constant of NONE.\n     * @type {number}\n     */\n    get NONE() {\n        return 0\n    },\n\n    /**\n     * Constant of CAPTURING_PHASE.\n     * @type {number}\n     */\n    get CAPTURING_PHASE() {\n        return 1\n    },\n\n    /**\n     * Constant of AT_TARGET.\n     * @type {number}\n     */\n    get AT_TARGET() {\n        return 2\n    },\n\n    /**\n     * Constant of BUBBLING_PHASE.\n     * @type {number}\n     */\n    get BUBBLING_PHASE() {\n        return 3\n    },\n\n    /**\n     * The target of this event.\n     * @type {number}\n     */\n    get eventPhase() {\n        return pd(this).eventPhase\n    },\n\n    /**\n     * Stop event bubbling.\n     * @returns {void}\n     */\n    stopPropagation() {\n        const data = pd(this);\n        if (typeof data.event.stopPropagation === \"function\") {\n            data.event.stopPropagation();\n        }\n    },\n\n    /**\n     * Stop event bubbling.\n     * @returns {void}\n     */\n    stopImmediatePropagation() {\n        const data = pd(this);\n\n        data.stopped = true;\n        if (typeof data.event.stopImmediatePropagation === \"function\") {\n            data.event.stopImmediatePropagation();\n        }\n    },\n\n    /**\n     * The flag to be bubbling.\n     * @type {boolean}\n     */\n    get bubbles() {\n        return Boolean(pd(this).event.bubbles)\n    },\n\n    /**\n     * The flag to be cancelable.\n     * @type {boolean}\n     */\n    get cancelable() {\n        return Boolean(pd(this).event.cancelable)\n    },\n\n    /**\n     * Cancel this event.\n     * @returns {void}\n     */\n    preventDefault() {\n        const data = pd(this);\n        if (data.passiveListener != null) {\n            console.warn(\"Event#preventDefault() was called from a passive listener:\", data.passiveListener);\n            return\n        }\n        if (!data.event.cancelable) {\n            return\n        }\n\n        data.canceled = true;\n        if (typeof data.event.preventDefault === \"function\") {\n            data.event.preventDefault();\n        }\n    },\n\n    /**\n     * The flag to indicate cancellation state.\n     * @type {boolean}\n     */\n    get defaultPrevented() {\n        return pd(this).canceled\n    },\n\n    /**\n     * The flag to be composed.\n     * @type {boolean}\n     */\n    get composed() {\n        return Boolean(pd(this).event.composed)\n    },\n\n    /**\n     * The unix time of this event.\n     * @type {number}\n     */\n    get timeStamp() {\n        return pd(this).timeStamp\n    },\n};\n\n// `constructor` is not enumerable.\nObject.defineProperty(Event.prototype, \"constructor\", { value: Event, configurable: true, writable: true });\n\n// Ensure `event instanceof window.Event` is `true`.\nif (typeof window !== \"undefined\" && typeof window.Event !== \"undefined\") {\n    Object.setPrototypeOf(Event.prototype, window.Event.prototype);\n\n    // Make association for wrappers.\n    wrappers.set(window.Event.prototype, Event);\n}\n\n/**\n * Get the property descriptor to redirect a given property.\n * @param {string} key Property name to define property descriptor.\n * @returns {PropertyDescriptor} The property descriptor to redirect the property.\n * @private\n */\nfunction defineRedirectDescriptor(key) {\n    return {\n        get() {\n            return pd(this).event[key]\n        },\n        set(value) {\n            pd(this).event[key] = value;\n        },\n        configurable: true,\n        enumerable: true,\n    }\n}\n\n/**\n * Get the property descriptor to call a given method property.\n * @param {string} key Property name to define property descriptor.\n * @returns {PropertyDescriptor} The property descriptor to call the method property.\n * @private\n */\nfunction defineCallDescriptor(key) {\n    return {\n        value() {\n            const event = pd(this).event;\n            return event[key].apply(event, arguments)\n        },\n        configurable: true,\n        enumerable: true,\n    }\n}\n\n/**\n * Define new wrapper class.\n * @param {Function} BaseEvent The base wrapper class.\n * @param {Object} proto The prototype of the original event.\n * @returns {Function} The defined wrapper class.\n * @private\n */\nfunction defineWrapper(BaseEvent, proto) {\n    const keys = Object.keys(proto);\n    if (keys.length === 0) {\n        return BaseEvent\n    }\n\n    /** CustomEvent */\n    function CustomEvent(eventTarget, event) {\n        BaseEvent.call(this, eventTarget, event);\n    }\n\n    CustomEvent.prototype = Object.create(BaseEvent.prototype, {\n        constructor: { value: CustomEvent, configurable: true, writable: true },\n    });\n\n    // Define accessors.\n    for (let i = 0; i < keys.length; ++i) {\n        const key = keys[i];\n        if (!(key in BaseEvent.prototype)) {\n            const descriptor = Object.getOwnPropertyDescriptor(proto, key);\n            const isFunc = (typeof descriptor.value === \"function\");\n            Object.defineProperty(\n                CustomEvent.prototype,\n                key,\n                isFunc ? defineCallDescriptor(key) : defineRedirectDescriptor(key)\n            );\n        }\n    }\n\n    return CustomEvent\n}\n\n/**\n * Get the wrapper class of a given prototype.\n * @param {Object} proto The prototype of the original event to get its wrapper.\n * @returns {Function} The wrapper class.\n * @private\n */\nfunction getWrapper(proto) {\n    if (proto == null || proto === Object.prototype) {\n        return Event\n    }\n\n    let wrapper = wrappers.get(proto);\n    if (wrapper == null) {\n        wrapper = defineWrapper(getWrapper(Object.getPrototypeOf(proto)), proto);\n        wrappers.set(proto, wrapper);\n    }\n    return wrapper\n}\n\n/**\n * Wrap a given event to management a dispatching.\n * @param {EventTarget} eventTarget The event target of this dispatching.\n * @param {Object} event The event to wrap.\n * @returns {Event} The wrapper instance.\n * @private\n */\nfunction wrapEvent(eventTarget, event) {\n    const Wrapper = getWrapper(Object.getPrototypeOf(event));\n    return new Wrapper(eventTarget, event)\n}\n\n/**\n * Get the stopped flag of a given event.\n * @param {Event} event The event to get.\n * @returns {boolean} The flag to stop propagation immediately.\n * @private\n */\nfunction isStopped(event) {\n    return pd(event).stopped\n}\n\n/**\n * Set the current event phase of a given event.\n * @param {Event} event The event to set current target.\n * @param {number} eventPhase New event phase.\n * @returns {void}\n * @private\n */\nfunction setEventPhase(event, eventPhase) {\n    pd(event).eventPhase = eventPhase;\n}\n\n/**\n * Set the current target of a given event.\n * @param {Event} event The event to set current target.\n * @param {EventTarget|null} currentTarget New current target.\n * @returns {void}\n * @private\n */\nfunction setCurrentTarget(event, currentTarget) {\n    pd(event).currentTarget = currentTarget;\n}\n\n/**\n * Set a passive listener of a given event.\n * @param {Event} event The event to set current target.\n * @param {Function|null} passiveListener New passive listener.\n * @returns {void}\n * @private\n */\nfunction setPassiveListener(event, passiveListener) {\n    pd(event).passiveListener = passiveListener;\n}\n\n/**\n * @typedef {object} ListenerNode\n * @property {Function} listener\n * @property {1|2|3} listenerType\n * @property {boolean} passive\n * @property {boolean} once\n * @property {ListenerNode|null} next\n * @private\n */\n\n/**\n * @type {WeakMap<object, Map<string, ListenerNode>>}\n * @private\n */\nconst listenersMap = new WeakMap();\n\n// Listener types\nconst CAPTURE = 1;\nconst BUBBLE = 2;\nconst ATTRIBUTE = 3;\n\n/**\n * Check whether a given value is an object or not.\n * @param {any} x The value to check.\n * @returns {boolean} `true` if the value is an object.\n */\nfunction isObject(x) {\n    return x !== null && typeof x === \"object\" //eslint-disable-line no-restricted-syntax\n}\n\n/**\n * Get listeners.\n * @param {EventTarget} eventTarget The event target to get.\n * @returns {Map<string, ListenerNode>} The listeners.\n * @private\n */\nfunction getListeners(eventTarget) {\n    const listeners = listenersMap.get(eventTarget);\n    if (listeners == null) {\n        throw new TypeError(\"'this' is expected an EventTarget object, but got another value.\")\n    }\n    return listeners\n}\n\n/**\n * Get the property descriptor for the event attribute of a given event.\n * @param {string} eventName The event name to get property descriptor.\n * @returns {PropertyDescriptor} The property descriptor.\n * @private\n */\nfunction defineEventAttributeDescriptor(eventName) {\n    return {\n        get() {\n            const listeners = getListeners(this);\n            let node = listeners.get(eventName);\n            while (node != null) {\n                if (node.listenerType === ATTRIBUTE) {\n                    return node.listener\n                }\n                node = node.next;\n            }\n            return null\n        },\n\n        set(listener) {\n            if (typeof listener !== \"function\" && !isObject(listener)) {\n                listener = null; // eslint-disable-line no-param-reassign\n            }\n            const listeners = getListeners(this);\n\n            // Traverse to the tail while removing old value.\n            let prev = null;\n            let node = listeners.get(eventName);\n            while (node != null) {\n                if (node.listenerType === ATTRIBUTE) {\n                    // Remove old value.\n                    if (prev !== null) {\n                        prev.next = node.next;\n                    }\n                    else if (node.next !== null) {\n                        listeners.set(eventName, node.next);\n                    }\n                    else {\n                        listeners.delete(eventName);\n                    }\n                }\n                else {\n                    prev = node;\n                }\n\n                node = node.next;\n            }\n\n            // Add new value.\n            if (listener !== null) {\n                const newNode = {\n                    listener,\n                    listenerType: ATTRIBUTE,\n                    passive: false,\n                    once: false,\n                    next: null,\n                };\n                if (prev === null) {\n                    listeners.set(eventName, newNode);\n                }\n                else {\n                    prev.next = newNode;\n                }\n            }\n        },\n        configurable: true,\n        enumerable: true,\n    }\n}\n\n/**\n * Define an event attribute (e.g. `eventTarget.onclick`).\n * @param {Object} eventTargetPrototype The event target prototype to define an event attrbite.\n * @param {string} eventName The event name to define.\n * @returns {void}\n */\nfunction defineEventAttribute(eventTargetPrototype, eventName) {\n    Object.defineProperty(eventTargetPrototype, `on${eventName}`, defineEventAttributeDescriptor(eventName));\n}\n\n/**\n * Define a custom EventTarget with event attributes.\n * @param {string[]} eventNames Event names for event attributes.\n * @returns {EventTarget} The custom EventTarget.\n * @private\n */\nfunction defineCustomEventTarget(eventNames) {\n    /** CustomEventTarget */\n    function CustomEventTarget() {\n        EventTarget.call(this);\n    }\n\n    CustomEventTarget.prototype = Object.create(EventTarget.prototype, {\n        constructor: { value: CustomEventTarget, configurable: true, writable: true },\n    });\n\n    for (let i = 0; i < eventNames.length; ++i) {\n        defineEventAttribute(CustomEventTarget.prototype, eventNames[i]);\n    }\n\n    return CustomEventTarget\n}\n\n/**\n * EventTarget.\n *\n * - This is constructor if no arguments.\n * - This is a function which returns a CustomEventTarget constructor if there are arguments.\n *\n * For example:\n *\n *     class A extends EventTarget {}\n *     class B extends EventTarget(\"message\") {}\n *     class C extends EventTarget(\"message\", \"error\") {}\n *     class D extends EventTarget([\"message\", \"error\"]) {}\n */\nfunction EventTarget() {\n    /*eslint-disable consistent-return */\n    if (this instanceof EventTarget) {\n        listenersMap.set(this, new Map());\n        return\n    }\n    if (arguments.length === 1 && Array.isArray(arguments[0])) {\n        return defineCustomEventTarget(arguments[0])\n    }\n    if (arguments.length > 0) {\n        const types = new Array(arguments.length);\n        for (let i = 0; i < arguments.length; ++i) {\n            types[i] = arguments[i];\n        }\n        return defineCustomEventTarget(types)\n    }\n    throw new TypeError(\"Cannot call a class as a function\")\n    /*eslint-enable consistent-return */\n}\n\n// Should be enumerable, but class methods are not enumerable.\nEventTarget.prototype = {\n    /**\n     * Add a given listener to this event target.\n     * @param {string} eventName The event name to add.\n     * @param {Function} listener The listener to add.\n     * @param {boolean|{capture?:boolean,passive?:boolean,once?:boolean}} [options] The options for this listener.\n     * @returns {boolean} `true` if the listener was added actually.\n     */\n    addEventListener(eventName, listener, options) {\n        if (listener == null) {\n            return false\n        }\n        if (typeof listener !== \"function\" && !isObject(listener)) {\n            throw new TypeError(\"'listener' should be a function or an object.\")\n        }\n\n        const listeners = getListeners(this);\n        const optionsIsObj = isObject(options);\n        const capture = optionsIsObj ? Boolean(options.capture) : Boolean(options);\n        const listenerType = (capture ? CAPTURE : BUBBLE);\n        const newNode = {\n            listener,\n            listenerType,\n            passive: optionsIsObj && Boolean(options.passive),\n            once: optionsIsObj && Boolean(options.once),\n            next: null,\n        };\n\n        // Set it as the first node if the first node is null.\n        let node = listeners.get(eventName);\n        if (node === undefined) {\n            listeners.set(eventName, newNode);\n            return true\n        }\n\n        // Traverse to the tail while checking duplication..\n        let prev = null;\n        while (node != null) {\n            if (node.listener === listener && node.listenerType === listenerType) {\n                // Should ignore duplication.\n                return false\n            }\n            prev = node;\n            node = node.next;\n        }\n\n        // Add it.\n        prev.next = newNode;\n        return true\n    },\n\n    /**\n     * Remove a given listener from this event target.\n     * @param {string} eventName The event name to remove.\n     * @param {Function} listener The listener to remove.\n     * @param {boolean|{capture?:boolean,passive?:boolean,once?:boolean}} [options] The options for this listener.\n     * @returns {boolean} `true` if the listener was removed actually.\n     */\n    removeEventListener(eventName, listener, options) {\n        if (listener == null) {\n            return false\n        }\n\n        const listeners = getListeners(this);\n        const capture = isObject(options) ? Boolean(options.capture) : Boolean(options);\n        const listenerType = (capture ? CAPTURE : BUBBLE);\n\n        let prev = null;\n        let node = listeners.get(eventName);\n        while (node != null) {\n            if (node.listener === listener && node.listenerType === listenerType) {\n                if (prev !== null) {\n                    prev.next = node.next;\n                }\n                else if (node.next !== null) {\n                    listeners.set(eventName, node.next);\n                }\n                else {\n                    listeners.delete(eventName);\n                }\n                return true\n            }\n\n            prev = node;\n            node = node.next;\n        }\n\n        return false\n    },\n\n    /**\n     * Dispatch a given event.\n     * @param {Event|{type:string}} event The event to dispatch.\n     * @returns {boolean} `false` if canceled.\n     */\n    dispatchEvent(event) { //eslint-disable-line complexity\n        if (event == null || typeof event.type !== \"string\") {\n            throw new TypeError(\"\\\"event.type\\\" should be a string.\")\n        }\n\n        // If listeners aren't registered, terminate.\n        const listeners = getListeners(this);\n        const eventName = event.type;\n        let node = listeners.get(eventName);\n        if (node == null) {\n            return true\n        }\n\n        // Since we cannot rewrite several properties, so wrap object.\n        const wrappedEvent = wrapEvent(this, event);\n\n        // This doesn't process capturing phase and bubbling phase.\n        // This isn't participating in a tree.\n        let prev = null;\n        while (node != null) {\n            // Remove this listener if it's once\n            if (node.once) {\n                if (prev !== null) {\n                    prev.next = node.next;\n                }\n                else if (node.next !== null) {\n                    listeners.set(eventName, node.next);\n                }\n                else {\n                    listeners.delete(eventName);\n                }\n            }\n            else {\n                prev = node;\n            }\n\n            // Call this listener\n            setPassiveListener(wrappedEvent, (node.passive ? node.listener : null));\n            if (typeof node.listener === \"function\") {\n                try {\n                    node.listener.call(this, wrappedEvent);\n                }\n                catch (err) {\n                    /*eslint-disable no-console */\n                    if (typeof console !== \"undefined\" && typeof console.error === \"function\") {\n                        console.error(err);\n                    }\n                    /*eslint-enable no-console */\n                }\n            }\n            else if (node.listenerType !== ATTRIBUTE && typeof node.listener.handleEvent === \"function\") {\n                node.listener.handleEvent(wrappedEvent);\n            }\n\n            // Break if `event.stopImmediatePropagation` was called.\n            if (isStopped(wrappedEvent)) {\n                break\n            }\n\n            node = node.next;\n        }\n        setPassiveListener(wrappedEvent, null);\n        setEventPhase(wrappedEvent, 0);\n        setCurrentTarget(wrappedEvent, null);\n\n        return !wrappedEvent.defaultPrevented\n    },\n};\n\n// `constructor` is not enumerable.\nObject.defineProperty(EventTarget.prototype, \"constructor\", { value: EventTarget, configurable: true, writable: true });\n\n// Ensure `eventTarget instanceof window.EventTarget` is `true`.\nif (typeof window !== \"undefined\" && typeof window.EventTarget !== \"undefined\") {\n    Object.setPrototypeOf(EventTarget.prototype, window.EventTarget.prototype);\n}\n\nexport default EventTarget;\nexport { defineEventAttribute, EventTarget };\n//# sourceMappingURL=event-target-shim.mjs.map\n","'use strict';\n\nvar urilib = require('url');\n\nvar attribute = require('./attribute');\nvar helpers = require('./helpers');\nvar scanSchema = require('./scan').scan;\nvar ValidatorResult = helpers.ValidatorResult;\nvar SchemaError = helpers.SchemaError;\nvar SchemaContext = helpers.SchemaContext;\n//var anonymousBase = 'vnd.jsonschema:///';\nvar anonymousBase = '/';\n\n/**\n * Creates a new Validator object\n * @name Validator\n * @constructor\n */\nvar Validator = function Validator () {\n  // Allow a validator instance to override global custom formats or to have their\n  // own custom formats.\n  this.customFormats = Object.create(Validator.prototype.customFormats);\n  this.schemas = {};\n  this.unresolvedRefs = [];\n\n  // Use Object.create to make this extensible without Validator instances stepping on each other's toes.\n  this.types = Object.create(types);\n  this.attributes = Object.create(attribute.validators);\n};\n\n// Allow formats to be registered globally.\nValidator.prototype.customFormats = {};\n\n// Hint at the presence of a property\nValidator.prototype.schemas = null;\nValidator.prototype.types = null;\nValidator.prototype.attributes = null;\nValidator.prototype.unresolvedRefs = null;\n\n/**\n * Adds a schema with a certain urn to the Validator instance.\n * @param schema\n * @param urn\n * @return {Object}\n */\nValidator.prototype.addSchema = function addSchema (schema, base) {\n  var self = this;\n  if (!schema) {\n    return null;\n  }\n  var scan = scanSchema(base||anonymousBase, schema);\n  var ourUri = base || schema.id;\n  for(var uri in scan.id){\n    this.schemas[uri] = scan.id[uri];\n  }\n  for(var uri in scan.ref){\n    this.unresolvedRefs.push(uri);\n  }\n  this.unresolvedRefs = this.unresolvedRefs.filter(function(uri){\n    return typeof self.schemas[uri]==='undefined';\n  });\n  return this.schemas[ourUri];\n};\n\nValidator.prototype.addSubSchemaArray = function addSubSchemaArray(baseuri, schemas) {\n  if(!(schemas instanceof Array)) return;\n  for(var i=0; i<schemas.length; i++){\n    this.addSubSchema(baseuri, schemas[i]);\n  }\n};\n\nValidator.prototype.addSubSchemaObject = function addSubSchemaArray(baseuri, schemas) {\n  if(!schemas || typeof schemas!='object') return;\n  for(var p in schemas){\n    this.addSubSchema(baseuri, schemas[p]);\n  }\n};\n\n\n\n/**\n * Sets all the schemas of the Validator instance.\n * @param schemas\n */\nValidator.prototype.setSchemas = function setSchemas (schemas) {\n  this.schemas = schemas;\n};\n\n/**\n * Returns the schema of a certain urn\n * @param urn\n */\nValidator.prototype.getSchema = function getSchema (urn) {\n  return this.schemas[urn];\n};\n\n/**\n * Validates instance against the provided schema\n * @param instance\n * @param schema\n * @param [options]\n * @param [ctx]\n * @return {Array}\n */\nValidator.prototype.validate = function validate (instance, schema, options, ctx) {\n  if (!options) {\n    options = {};\n  }\n  var propertyName = options.propertyName || 'instance';\n  // This will work so long as the function at uri.resolve() will resolve a relative URI to a relative URI\n  var base = urilib.resolve(options.base||anonymousBase, schema.id||'');\n  if(!ctx){\n    ctx = new SchemaContext(schema, options, propertyName, base, Object.create(this.schemas));\n    if (!ctx.schemas[base]) {\n      ctx.schemas[base] = schema;\n    }\n    var found = scanSchema(base, schema);\n    for(var n in found.id){\n      var sch = found.id[n];\n      ctx.schemas[n] = sch;\n    }\n  }\n  if (schema) {\n    var result = this.validateSchema(instance, schema, options, ctx);\n    if (!result) {\n      throw new Error('Result undefined');\n    }\n    return result;\n  }\n  throw new SchemaError('no schema specified', schema);\n};\n\n/**\n* @param Object schema\n* @return mixed schema uri or false\n*/\nfunction shouldResolve(schema) {\n  var ref = (typeof schema === 'string') ? schema : schema.$ref;\n  if (typeof ref=='string') return ref;\n  return false;\n}\n\n/**\n * Validates an instance against the schema (the actual work horse)\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @private\n * @return {ValidatorResult}\n */\nValidator.prototype.validateSchema = function validateSchema (instance, schema, options, ctx) {\n  var result = new ValidatorResult(instance, schema, options, ctx);\n\n    // Support for the true/false schemas\n  if(typeof schema==='boolean') {\n    if(schema===true){\n      // `true` is always valid\n      schema = {};\n    }else if(schema===false){\n      // `false` is always invalid\n      schema = {type: []};\n    }\n  }else if(!schema){\n    // This might be a string\n    throw new Error(\"schema is undefined\");\n  }\n\n  if (schema['extends']) {\n    if (schema['extends'] instanceof Array) {\n      var schemaobj = {schema: schema, ctx: ctx};\n      schema['extends'].forEach(this.schemaTraverser.bind(this, schemaobj));\n      schema = schemaobj.schema;\n      schemaobj.schema = null;\n      schemaobj.ctx = null;\n      schemaobj = null;\n    } else {\n      schema = helpers.deepMerge(schema, this.superResolve(schema['extends'], ctx));\n    }\n  }\n\n  // If passed a string argument, load that schema URI\n  var switchSchema;\n  if (switchSchema = shouldResolve(schema)) {\n    var resolved = this.resolve(schema, switchSchema, ctx);\n    var subctx = new SchemaContext(resolved.subschema, options, ctx.propertyPath, resolved.switchSchema, ctx.schemas);\n    return this.validateSchema(instance, resolved.subschema, options, subctx);\n  }\n\n  var skipAttributes = options && options.skipAttributes || [];\n  // Validate each schema attribute against the instance\n  for (var key in schema) {\n    if (!attribute.ignoreProperties[key] && skipAttributes.indexOf(key) < 0) {\n      var validatorErr = null;\n      var validator = this.attributes[key];\n      if (validator) {\n        validatorErr = validator.call(this, instance, schema, options, ctx);\n      } else if (options.allowUnknownAttributes === false) {\n        // This represents an error with the schema itself, not an invalid instance\n        throw new SchemaError(\"Unsupported attribute: \" + key, schema);\n      }\n      if (validatorErr) {\n        result.importErrors(validatorErr);\n      }\n    }\n  }\n\n  if (typeof options.rewrite == 'function') {\n    var value = options.rewrite.call(this, instance, schema, options, ctx);\n    result.instance = value;\n  }\n  return result;\n};\n\n/**\n* @private\n* @param Object schema\n* @param SchemaContext ctx\n* @returns Object schema or resolved schema\n*/\nValidator.prototype.schemaTraverser = function schemaTraverser (schemaobj, s) {\n  schemaobj.schema = helpers.deepMerge(schemaobj.schema, this.superResolve(s, schemaobj.ctx));\n}\n\n/**\n* @private\n* @param Object schema\n* @param SchemaContext ctx\n* @returns Object schema or resolved schema\n*/\nValidator.prototype.superResolve = function superResolve (schema, ctx) {\n  var ref;\n  if(ref = shouldResolve(schema)) {\n    return this.resolve(schema, ref, ctx).subschema;\n  }\n  return schema;\n}\n\n/**\n* @private\n* @param Object schema\n* @param Object switchSchema\n* @param SchemaContext ctx\n* @return Object resolved schemas {subschema:String, switchSchema: String}\n* @throws SchemaError\n*/\nValidator.prototype.resolve = function resolve (schema, switchSchema, ctx) {\n  switchSchema = ctx.resolve(switchSchema);\n  // First see if the schema exists under the provided URI\n  if (ctx.schemas[switchSchema]) {\n    return {subschema: ctx.schemas[switchSchema], switchSchema: switchSchema};\n  }\n  // Else try walking the property pointer\n  var parsed = urilib.parse(switchSchema);\n  var fragment = parsed && parsed.hash;\n  var document = fragment && fragment.length && switchSchema.substr(0, switchSchema.length - fragment.length);\n  if (!document || !ctx.schemas[document]) {\n    throw new SchemaError(\"no such schema <\" + switchSchema + \">\", schema);\n  }\n  var subschema = helpers.objectGetPath(ctx.schemas[document], fragment.substr(1));\n  if(subschema===undefined){\n    throw new SchemaError(\"no such schema \" + fragment + \" located in <\" + document + \">\", schema);\n  }\n  return {subschema: subschema, switchSchema: switchSchema};\n};\n\n/**\n * Tests whether the instance if of a certain type.\n * @private\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @param type\n * @return {boolean}\n */\nValidator.prototype.testType = function validateType (instance, schema, options, ctx, type) {\n  if (typeof this.types[type] == 'function') {\n    return this.types[type].call(this, instance);\n  }\n  if (type && typeof type == 'object') {\n    var res = this.validateSchema(instance, type, options, ctx);\n    return res === undefined || !(res && res.errors.length);\n  }\n  // Undefined or properties not on the list are acceptable, same as not being defined\n  return true;\n};\n\nvar types = Validator.prototype.types = {};\ntypes.string = function testString (instance) {\n  return typeof instance == 'string';\n};\ntypes.number = function testNumber (instance) {\n  // isFinite returns false for NaN, Infinity, and -Infinity\n  return typeof instance == 'number' && isFinite(instance);\n};\ntypes.integer = function testInteger (instance) {\n  return (typeof instance == 'number') && instance % 1 === 0;\n};\ntypes.boolean = function testBoolean (instance) {\n  return typeof instance == 'boolean';\n};\ntypes.array = function testArray (instance) {\n  return Array.isArray(instance);\n};\ntypes['null'] = function testNull (instance) {\n  return instance === null;\n};\ntypes.date = function testDate (instance) {\n  return instance instanceof Date;\n};\ntypes.any = function testAny (instance) {\n  return true;\n};\ntypes.object = function testObject (instance) {\n  // TODO: fix this - see #15\n  return instance && (typeof instance) === 'object' && !(instance instanceof Array) && !(instance instanceof Date);\n};\n\nmodule.exports = Validator;\n","'use strict';\n\nvar helpers = require('./helpers');\n\n/** @type ValidatorResult */\nvar ValidatorResult = helpers.ValidatorResult;\n/** @type SchemaError */\nvar SchemaError = helpers.SchemaError;\n\nvar attribute = {};\n\nattribute.ignoreProperties = {\n  // informative properties\n  'id': true,\n  'default': true,\n  'description': true,\n  'title': true,\n  // arguments to other properties\n  'exclusiveMinimum': true,\n  'exclusiveMaximum': true,\n  'additionalItems': true,\n  // special-handled properties\n  '$schema': true,\n  '$ref': true,\n  'extends': true\n};\n\n/**\n * @name validators\n */\nvar validators = attribute.validators = {};\n\n/**\n * Validates whether the instance if of a certain type\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {ValidatorResult|null}\n */\nvalidators.type = function validateType (instance, schema, options, ctx) {\n  // Ignore undefined instances\n  if (instance === undefined) {\n    return null;\n  }\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var types = Array.isArray(schema.type) ? schema.type : [schema.type];\n  if (!types.some(this.testType.bind(this, instance, schema, options, ctx))) {\n    var list = types.map(function (v) {\n      return v.id && ('<' + v.id + '>') || (v+'');\n    });\n    result.addError({\n      name: 'type',\n      argument: list,\n      message: \"is not of a type(s) \" + list,\n    });\n  }\n  return result;\n};\n\nfunction testSchemaNoThrow(instance, options, ctx, callback, schema){\n  var throwError = options.throwError;\n  options.throwError = false;\n  var res = this.validateSchema(instance, schema, options, ctx);\n  options.throwError = throwError;\n\n  if (! res.valid && callback instanceof Function) {\n    callback(res);\n  }\n  return res.valid;\n}\n\n/**\n * Validates whether the instance matches some of the given schemas\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {ValidatorResult|null}\n */\nvalidators.anyOf = function validateAnyOf (instance, schema, options, ctx) {\n  // Ignore undefined instances\n  if (instance === undefined) {\n    return null;\n  }\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var inner = new ValidatorResult(instance, schema, options, ctx);\n  if (!Array.isArray(schema.anyOf)){\n    throw new SchemaError(\"anyOf must be an array\");\n  }\n  if (!schema.anyOf.some(\n    testSchemaNoThrow.bind(\n      this, instance, options, ctx, function(res){inner.importErrors(res);}\n      ))) {\n    var list = schema.anyOf.map(function (v, i) {\n      return (v.id && ('<' + v.id + '>')) || (v.title && JSON.stringify(v.title)) || (v['$ref'] && ('<' + v['$ref'] + '>')) || '[subschema '+i+']';\n    });\n    if (options.nestedErrors) {\n      result.importErrors(inner);\n    }\n    result.addError({\n      name: 'anyOf',\n      argument: list,\n      message: \"is not any of \" + list.join(','),\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance matches every given schema\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {String|null}\n */\nvalidators.allOf = function validateAllOf (instance, schema, options, ctx) {\n  // Ignore undefined instances\n  if (instance === undefined) {\n    return null;\n  }\n  if (!Array.isArray(schema.allOf)){\n    throw new SchemaError(\"allOf must be an array\");\n  }\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var self = this;\n  schema.allOf.forEach(function(v, i){\n    var valid = self.validateSchema(instance, v, options, ctx);\n    if(!valid.valid){\n      var msg = (v.id && ('<' + v.id + '>')) || (v.title && JSON.stringify(v.title)) || (v['$ref'] && ('<' + v['$ref'] + '>')) || '[subschema '+i+']';\n      result.addError({\n        name: 'allOf',\n        argument: { id: msg, length: valid.errors.length, valid: valid },\n        message: 'does not match allOf schema ' + msg + ' with ' + valid.errors.length + ' error[s]:',\n      });\n      result.importErrors(valid);\n    }\n  });\n  return result;\n};\n\n/**\n * Validates whether the instance matches exactly one of the given schemas\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {String|null}\n */\nvalidators.oneOf = function validateOneOf (instance, schema, options, ctx) {\n  // Ignore undefined instances\n  if (instance === undefined) {\n    return null;\n  }\n  if (!Array.isArray(schema.oneOf)){\n    throw new SchemaError(\"oneOf must be an array\");\n  }\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var inner = new ValidatorResult(instance, schema, options, ctx);\n  var count = schema.oneOf.filter(\n    testSchemaNoThrow.bind(\n      this, instance, options, ctx, function(res) {inner.importErrors(res);}\n      ) ).length;\n  var list = schema.oneOf.map(function (v, i) {\n    return (v.id && ('<' + v.id + '>')) || (v.title && JSON.stringify(v.title)) || (v['$ref'] && ('<' + v['$ref'] + '>')) || '[subschema '+i+']';\n  });\n  if (count!==1) {\n    if (options.nestedErrors) {\n      result.importErrors(inner);\n    }\n    result.addError({\n      name: 'oneOf',\n      argument: list,\n      message: \"is not exactly one from \" + list.join(','),\n    });\n  }\n  return result;\n};\n\n/**\n * Validates properties\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {String|null|ValidatorResult}\n */\nvalidators.properties = function validateProperties (instance, schema, options, ctx) {\n  if(!this.types.object(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var properties = schema.properties || {};\n  for (var property in properties) {\n    if (typeof options.preValidateProperty == 'function') {\n      options.preValidateProperty(instance, property, properties[property], options, ctx);\n    }\n\n    var prop = Object.hasOwnProperty.call(instance, property) ? instance[property] : undefined;\n    var res = this.validateSchema(prop, properties[property], options, ctx.makeChild(properties[property], property));\n    if(res.instance !== result.instance[property]) result.instance[property] = res.instance;\n    result.importErrors(res);\n  }\n  return result;\n};\n\n/**\n * Test a specific property within in instance against the additionalProperties schema attribute\n * This ignores properties with definitions in the properties schema attribute, but no other attributes.\n * If too many more types of property-existance tests pop up they may need their own class of tests (like `type` has)\n * @private\n * @return {boolean}\n */\nfunction testAdditionalProperty (instance, schema, options, ctx, property, result) {\n  if(!this.types.object(instance)) return;\n  if (schema.properties && schema.properties[property] !== undefined) {\n    return;\n  }\n  if (schema.additionalProperties === false) {\n    result.addError({\n      name: 'additionalProperties',\n      argument: property,\n      message: \"additionalProperty \" + JSON.stringify(property) + \" exists in instance when not allowed\",\n    });\n  } else {\n    var additionalProperties = schema.additionalProperties || {};\n\n    if (typeof options.preValidateProperty == 'function') {\n      options.preValidateProperty(instance, property, additionalProperties, options, ctx);\n    }\n\n    var res = this.validateSchema(instance[property], additionalProperties, options, ctx.makeChild(additionalProperties, property));\n    if(res.instance !== result.instance[property]) result.instance[property] = res.instance;\n    result.importErrors(res);\n  }\n}\n\n/**\n * Validates patternProperties\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {String|null|ValidatorResult}\n */\nvalidators.patternProperties = function validatePatternProperties (instance, schema, options, ctx) {\n  if(!this.types.object(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var patternProperties = schema.patternProperties || {};\n\n  for (var property in instance) {\n    var test = true;\n    for (var pattern in patternProperties) {\n      var expr = new RegExp(pattern);\n      if (!expr.test(property)) {\n        continue;\n      }\n      test = false;\n\n      if (typeof options.preValidateProperty == 'function') {\n        options.preValidateProperty(instance, property, patternProperties[pattern], options, ctx);\n      }\n\n      var res = this.validateSchema(instance[property], patternProperties[pattern], options, ctx.makeChild(patternProperties[pattern], property));\n      if(res.instance !== result.instance[property]) result.instance[property] = res.instance;\n      result.importErrors(res);\n    }\n    if (test) {\n      testAdditionalProperty.call(this, instance, schema, options, ctx, property, result);\n    }\n  }\n\n  return result;\n};\n\n/**\n * Validates additionalProperties\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {String|null|ValidatorResult}\n */\nvalidators.additionalProperties = function validateAdditionalProperties (instance, schema, options, ctx) {\n  if(!this.types.object(instance)) return;\n  // if patternProperties is defined then we'll test when that one is called instead\n  if (schema.patternProperties) {\n    return null;\n  }\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  for (var property in instance) {\n    testAdditionalProperty.call(this, instance, schema, options, ctx, property, result);\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance value is at least of a certain length, when the instance value is a string.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.minProperties = function validateMinProperties (instance, schema, options, ctx) {\n  if (!this.types.object(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var keys = Object.keys(instance);\n  if (!(keys.length >= schema.minProperties)) {\n    result.addError({\n      name: 'minProperties',\n      argument: schema.minProperties,\n      message: \"does not meet minimum property length of \" + schema.minProperties,\n    })\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance value is at most of a certain length, when the instance value is a string.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.maxProperties = function validateMaxProperties (instance, schema, options, ctx) {\n  if (!this.types.object(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var keys = Object.keys(instance);\n  if (!(keys.length <= schema.maxProperties)) {\n    result.addError({\n      name: 'maxProperties',\n      argument: schema.maxProperties,\n      message: \"does not meet maximum property length of \" + schema.maxProperties,\n    });\n  }\n  return result;\n};\n\n/**\n * Validates items when instance is an array\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {String|null|ValidatorResult}\n */\nvalidators.items = function validateItems (instance, schema, options, ctx) {\n  var self = this;\n  if (!this.types.array(instance)) return;\n  if (!schema.items) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  instance.every(function (value, i) {\n    var items = Array.isArray(schema.items) ? (schema.items[i] || schema.additionalItems) : schema.items;\n    if (items === undefined) {\n      return true;\n    }\n    if (items === false) {\n      result.addError({\n        name: 'items',\n        message: \"additionalItems not permitted\",\n      });\n      return false;\n    }\n    var res = self.validateSchema(value, items, options, ctx.makeChild(items, i));\n    if(res.instance !== result.instance[i]) result.instance[i] = res.instance;\n    result.importErrors(res);\n    return true;\n  });\n  return result;\n};\n\n/**\n * Validates minimum and exclusiveMinimum when the type of the instance value is a number.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.minimum = function validateMinimum (instance, schema, options, ctx) {\n  if (!this.types.number(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var valid = true;\n  if (schema.exclusiveMinimum && schema.exclusiveMinimum === true) {\n    valid = instance > schema.minimum;\n  } else {\n    valid = instance >= schema.minimum;\n  }\n  if (!valid) {\n    result.addError({\n      name: 'minimum',\n      argument: schema.minimum,\n      message: \"must have a minimum value of \" + schema.minimum,\n    });\n  }\n  return result;\n};\n\n/**\n * Validates maximum and exclusiveMaximum when the type of the instance value is a number.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.maximum = function validateMaximum (instance, schema, options, ctx) {\n  if (!this.types.number(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var valid;\n  if (schema.exclusiveMaximum && schema.exclusiveMaximum === true) {\n    valid = instance < schema.maximum;\n  } else {\n    valid = instance <= schema.maximum;\n  }\n  if (!valid) {\n    result.addError({\n      name: 'maximum',\n      argument: schema.maximum,\n      message: \"must have a maximum value of \" + schema.maximum,\n    });\n  }\n  return result;\n};\n\n/**\n * Perform validation for multipleOf and divisibleBy, which are essentially the same.\n * @param instance\n * @param schema\n * @param validationType\n * @param errorMessage\n * @returns {String|null}\n */\nvar validateMultipleOfOrDivisbleBy = function validateMultipleOfOrDivisbleBy (instance, schema, options, ctx, validationType, errorMessage) {\n  if (!this.types.number(instance)) return;\n\n  var validationArgument = schema[validationType];\n  if (validationArgument == 0) {\n    throw new SchemaError(validationType + \" cannot be zero\");\n  }\n\n  var result = new ValidatorResult(instance, schema, options, ctx);\n\n  var instanceDecimals = helpers.getDecimalPlaces(instance);\n  var divisorDecimals = helpers.getDecimalPlaces(validationArgument);\n\n  var maxDecimals = Math.max(instanceDecimals , divisorDecimals);\n  var multiplier = Math.pow(10, maxDecimals);\n\n  if (Math.round(instance * multiplier) % Math.round(validationArgument * multiplier) !== 0) {\n    result.addError({\n      name: validationType,\n      argument:  validationArgument,\n      message: errorMessage + JSON.stringify(validationArgument)\n    });\n  }\n\n  return result;\n};\n\n/**\n * Validates divisibleBy when the type of the instance value is a number.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.multipleOf = function validateMultipleOf (instance, schema, options, ctx) {\n return validateMultipleOfOrDivisbleBy.call(this, instance, schema, options, ctx, \"multipleOf\", \"is not a multiple of (divisible by) \");\n};\n\n/**\n * Validates multipleOf when the type of the instance value is a number.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.divisibleBy = function validateDivisibleBy (instance, schema, options, ctx) {\n  return validateMultipleOfOrDivisbleBy.call(this, instance, schema, options, ctx, \"divisibleBy\", \"is not divisible by (multiple of) \");\n};\n\n/**\n * Validates whether the instance value is present.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.required = function validateRequired (instance, schema, options, ctx) {\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (instance === undefined && schema.required === true) {\n    // A boolean form is implemented for reverse-compatability with schemas written against older drafts\n    result.addError({\n      name: 'required',\n      message: \"is required\"\n    });\n  } else if (this.types.object(instance) && Array.isArray(schema.required)) {\n    schema.required.forEach(function(n){\n      if(instance[n]===undefined){\n        result.addError({\n          name: 'required',\n          argument: n,\n          message: \"requires property \" + JSON.stringify(n),\n        });\n      }\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance value matches the regular expression, when the instance value is a string.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.pattern = function validatePattern (instance, schema, options, ctx) {\n  if (!this.types.string(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (!instance.match(schema.pattern)) {\n    result.addError({\n      name: 'pattern',\n      argument: schema.pattern,\n      message: \"does not match pattern \" + JSON.stringify(schema.pattern),\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance value is of a certain defined format or a custom\n * format.\n * The following formats are supported for string types:\n *   - date-time\n *   - date\n *   - time\n *   - ip-address\n *   - ipv6\n *   - uri\n *   - color\n *   - host-name\n *   - alpha\n *   - alpha-numeric\n *   - utc-millisec\n * @param instance\n * @param schema\n * @param [options]\n * @param [ctx]\n * @return {String|null}\n */\nvalidators.format = function validateFormat (instance, schema, options, ctx) {\n  if (instance===undefined) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (!result.disableFormat && !helpers.isFormat(instance, schema.format, this)) {\n    result.addError({\n      name: 'format',\n      argument: schema.format,\n      message: \"does not conform to the \" + JSON.stringify(schema.format) + \" format\",\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance value is at least of a certain length, when the instance value is a string.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.minLength = function validateMinLength (instance, schema, options, ctx) {\n  if (!this.types.string(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var hsp = instance.match(/[\\uDC00-\\uDFFF]/g);\n  var length = instance.length - (hsp ? hsp.length : 0);\n  if (!(length >= schema.minLength)) {\n    result.addError({\n      name: 'minLength',\n      argument: schema.minLength,\n      message: \"does not meet minimum length of \" + schema.minLength,\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance value is at most of a certain length, when the instance value is a string.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.maxLength = function validateMaxLength (instance, schema, options, ctx) {\n  if (!this.types.string(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  // TODO if this was already computed in \"minLength\", use that value instead of re-computing\n  var hsp = instance.match(/[\\uDC00-\\uDFFF]/g);\n  var length = instance.length - (hsp ? hsp.length : 0);\n  if (!(length <= schema.maxLength)) {\n    result.addError({\n      name: 'maxLength',\n      argument: schema.maxLength,\n      message: \"does not meet maximum length of \" + schema.maxLength,\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether instance contains at least a minimum number of items, when the instance is an Array.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.minItems = function validateMinItems (instance, schema, options, ctx) {\n  if (!this.types.array(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (!(instance.length >= schema.minItems)) {\n    result.addError({\n      name: 'minItems',\n      argument: schema.minItems,\n      message: \"does not meet minimum length of \" + schema.minItems,\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether instance contains no more than a maximum number of items, when the instance is an Array.\n * @param instance\n * @param schema\n * @return {String|null}\n */\nvalidators.maxItems = function validateMaxItems (instance, schema, options, ctx) {\n  if (!this.types.array(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (!(instance.length <= schema.maxItems)) {\n    result.addError({\n      name: 'maxItems',\n      argument: schema.maxItems,\n      message: \"does not meet maximum length of \" + schema.maxItems,\n    });\n  }\n  return result;\n};\n\n/**\n * Validates that every item in an instance array is unique, when instance is an array\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {String|null|ValidatorResult}\n */\nvalidators.uniqueItems = function validateUniqueItems (instance, schema, options, ctx) {\n  if (!this.types.array(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  function testArrays (v, i, a) {\n    for (var j = i + 1; j < a.length; j++) if (helpers.deepCompareStrict(v, a[j])) {\n      return false;\n    }\n    return true;\n  }\n  if (!instance.every(testArrays)) {\n    result.addError({\n      name: 'uniqueItems',\n      message: \"contains duplicate item\",\n    });\n  }\n  return result;\n};\n\n/**\n * Deep compares arrays for duplicates\n * @param v\n * @param i\n * @param a\n * @private\n * @return {boolean}\n */\nfunction testArrays (v, i, a) {\n  var j, len = a.length;\n  for (j = i + 1, len; j < len; j++) {\n    if (helpers.deepCompareStrict(v, a[j])) {\n      return false;\n    }\n  }\n  return true;\n}\n\n/**\n * Validates whether there are no duplicates, when the instance is an Array.\n * @param instance\n * @return {String|null}\n */\nvalidators.uniqueItems = function validateUniqueItems (instance, schema, options, ctx) {\n  if (!this.types.array(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (!instance.every(testArrays)) {\n    result.addError({\n      name: 'uniqueItems',\n      message: \"contains duplicate item\",\n    });\n  }\n  return result;\n};\n\n/**\n * Validate for the presence of dependency properties, if the instance is an object.\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {null|ValidatorResult}\n */\nvalidators.dependencies = function validateDependencies (instance, schema, options, ctx) {\n  if (!this.types.object(instance)) return;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  for (var property in schema.dependencies) {\n    if (instance[property] === undefined) {\n      continue;\n    }\n    var dep = schema.dependencies[property];\n    var childContext = ctx.makeChild(dep, property);\n    if (typeof dep == 'string') {\n      dep = [dep];\n    }\n    if (Array.isArray(dep)) {\n      dep.forEach(function (prop) {\n        if (instance[prop] === undefined) {\n          result.addError({\n            // FIXME there's two different \"dependencies\" errors here with slightly different outputs\n            // Can we make these the same? Or should we create different error types?\n            name: 'dependencies',\n            argument: childContext.propertyPath,\n            message: \"property \" + prop + \" not found, required by \" + childContext.propertyPath,\n          });\n        }\n      });\n    } else {\n      var res = this.validateSchema(instance, dep, options, childContext);\n      if(result.instance !== res.instance) result.instance = res.instance;\n      if (res && res.errors.length) {\n        result.addError({\n          name: 'dependencies',\n          argument: childContext.propertyPath,\n          message: \"does not meet dependency required by \" + childContext.propertyPath,\n        });\n        result.importErrors(res);\n      }\n    }\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance value is one of the enumerated values.\n *\n * @param instance\n * @param schema\n * @return {ValidatorResult|null}\n */\nvalidators['enum'] = function validateEnum (instance, schema, options, ctx) {\n  if (instance === undefined) {\n    return null;\n  }\n  if (!Array.isArray(schema['enum'])) {\n    throw new SchemaError(\"enum expects an array\", schema);\n  }\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (!schema['enum'].some(helpers.deepCompareStrict.bind(null, instance))) {\n    result.addError({\n      name: 'enum',\n      argument: schema['enum'],\n      message: \"is not one of enum values: \" + schema['enum'].map(String).join(','),\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance exactly matches a given value\n *\n * @param instance\n * @param schema\n * @return {ValidatorResult|null}\n */\nvalidators['const'] = function validateEnum (instance, schema, options, ctx) {\n  if (instance === undefined) {\n    return null;\n  }\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  if (!helpers.deepCompareStrict(schema['const'], instance)) {\n    result.addError({\n      name: 'const',\n      argument: schema['const'],\n      message: \"does not exactly match expected constant: \" + schema['const'],\n    });\n  }\n  return result;\n};\n\n/**\n * Validates whether the instance if of a prohibited type.\n * @param instance\n * @param schema\n * @param options\n * @param ctx\n * @return {null|ValidatorResult}\n */\nvalidators.not = validators.disallow = function validateNot (instance, schema, options, ctx) {\n  var self = this;\n  if(instance===undefined) return null;\n  var result = new ValidatorResult(instance, schema, options, ctx);\n  var notTypes = schema.not || schema.disallow;\n  if(!notTypes) return null;\n  if(!Array.isArray(notTypes)) notTypes=[notTypes];\n  notTypes.forEach(function (type) {\n    if (self.testType(instance, schema, options, ctx, type)) {\n      var schemaId = type && type.id && ('<' + type.id + '>') || type;\n      result.addError({\n        name: 'not',\n        argument: schemaId,\n        message: \"is of prohibited type \" + schemaId,\n      });\n    }\n  });\n  return result;\n};\n\nmodule.exports = attribute;\n","var atob = require('./atob');\n\nfunction b64DecodeUnicode(str) {\n  return decodeURIComponent(atob(str).replace(/(.)/g, function (m, p) {\n    var code = p.charCodeAt(0).toString(16).toUpperCase();\n    if (code.length < 2) {\n      code = '0' + code;\n    }\n    return '%' + code;\n  }));\n}\n\nmodule.exports = function(str) {\n  var output = str.replace(/-/g, \"+\").replace(/_/g, \"/\");\n  switch (output.length % 4) {\n    case 0:\n      break;\n    case 2:\n      output += \"==\";\n      break;\n    case 3:\n      output += \"=\";\n      break;\n    default:\n      throw \"Illegal base64url string!\";\n  }\n\n  try{\n    return b64DecodeUnicode(output);\n  } catch (err) {\n    return atob(output);\n  }\n};\n","/**\n * The code was extracted from:\n * https://github.com/davidchambers/Base64.js\n */\n\nvar chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\n\nfunction InvalidCharacterError(message) {\n  this.message = message;\n}\n\nInvalidCharacterError.prototype = new Error();\nInvalidCharacterError.prototype.name = 'InvalidCharacterError';\n\nfunction polyfill (input) {\n  var str = String(input).replace(/=+$/, '');\n  if (str.length % 4 == 1) {\n    throw new InvalidCharacterError(\"'atob' failed: The string to be decoded is not correctly encoded.\");\n  }\n  for (\n    // initialize result and counters\n    var bc = 0, bs, buffer, idx = 0, output = '';\n    // get next character\n    buffer = str.charAt(idx++);\n    // character found in table? initialize bit storage and add its ascii value;\n    ~buffer && (bs = bc % 4 ? bs * 64 + buffer : buffer,\n      // and if not first of each 4 characters,\n      // convert the first 8 bits to one ascii character\n      bc++ % 4) ? output += String.fromCharCode(255 & bs >> (-2 * bc & 6)) : 0\n  ) {\n    // try to find character in table (0-63, not found => -1)\n    buffer = chars.indexOf(buffer);\n  }\n  return output;\n}\n\n\nmodule.exports = typeof window !== 'undefined' && window.atob && window.atob.bind(window) || polyfill;\n","/**\n * Phoenix Channels JavaScript client\n *\n * ## Socket Connection\n *\n * A single connection is established to the server and\n * channels are multiplexed over the connection.\n * Connect to the server using the `Socket` class:\n *\n * ```javascript\n * let socket = new Socket(\"/socket\", {params: {userToken: \"123\"}})\n * socket.connect()\n * ```\n *\n * The `Socket` constructor takes the mount point of the socket,\n * the authentication params, as well as options that can be found in\n * the Socket docs, such as configuring the `LongPoll` transport, and\n * heartbeat.\n *\n * ## Channels\n *\n * Channels are isolated, concurrent processes on the server that\n * subscribe to topics and broker events between the client and server.\n * To join a channel, you must provide the topic, and channel params for\n * authorization. Here's an example chat room example where `\"new_msg\"`\n * events are listened for, messages are pushed to the server, and\n * the channel is joined with ok/error/timeout matches:\n *\n * ```javascript\n * let channel = socket.channel(\"room:123\", {token: roomToken})\n * channel.on(\"new_msg\", msg => console.log(\"Got message\", msg) )\n * $input.onEnter( e => {\n *   channel.push(\"new_msg\", {body: e.target.val}, 10000)\n *     .receive(\"ok\", (msg) => console.log(\"created message\", msg) )\n *     .receive(\"error\", (reasons) => console.log(\"create failed\", reasons) )\n *     .receive(\"timeout\", () => console.log(\"Networking issue...\") )\n * })\n *\n * channel.join()\n *   .receive(\"ok\", ({messages}) => console.log(\"catching up\", messages) )\n *   .receive(\"error\", ({reason}) => console.log(\"failed join\", reason) )\n *   .receive(\"timeout\", () => console.log(\"Networking issue. Still waiting...\"))\n *```\n *\n * ## Joining\n *\n * Creating a channel with `socket.channel(topic, params)`, binds the params to\n * `channel.params`, which are sent up on `channel.join()`.\n * Subsequent rejoins will send up the modified params for\n * updating authorization params, or passing up last_message_id information.\n * Successful joins receive an \"ok\" status, while unsuccessful joins\n * receive \"error\".\n *\n * ## Duplicate Join Subscriptions\n *\n * While the client may join any number of topics on any number of channels,\n * the client may only hold a single subscription for each unique topic at any\n * given time. When attempting to create a duplicate subscription,\n * the server will close the existing channel, log a warning, and\n * spawn a new channel for the topic. The client will have their\n * `channel.onClose` callbacks fired for the existing channel, and the new\n * channel join will have its receive hooks processed as normal.\n *\n * ## Pushing Messages\n *\n * From the previous example, we can see that pushing messages to the server\n * can be done with `channel.push(eventName, payload)` and we can optionally\n * receive responses from the push. Additionally, we can use\n * `receive(\"timeout\", callback)` to abort waiting for our other `receive` hooks\n *  and take action after some period of waiting. The default timeout is 10000ms.\n *\n *\n * ## Socket Hooks\n *\n * Lifecycle events of the multiplexed connection can be hooked into via\n * `socket.onError()` and `socket.onClose()` events, ie:\n *\n * ```javascript\n * socket.onError( () => console.log(\"there was an error with the connection!\") )\n * socket.onClose( () => console.log(\"the connection dropped\") )\n * ```\n *\n *\n * ## Channel Hooks\n *\n * For each joined channel, you can bind to `onError` and `onClose` events\n * to monitor the channel lifecycle, ie:\n *\n * ```javascript\n * channel.onError( () => console.log(\"there was an error!\") )\n * channel.onClose( () => console.log(\"the channel has gone away gracefully\") )\n * ```\n *\n * ### onError hooks\n *\n * `onError` hooks are invoked if the socket connection drops, or the channel\n * crashes on the server. In either case, a channel rejoin is attempted\n * automatically in an exponential backoff manner.\n *\n * ### onClose hooks\n *\n * `onClose` hooks are invoked only in two cases. 1) the channel explicitly\n * closed on the server, or 2). The client explicitly closed, by calling\n * `channel.leave()`\n *\n *\n * ## Presence\n *\n * The `Presence` object provides features for syncing presence information\n * from the server with the client and handling presences joining and leaving.\n *\n * ### Syncing state from the server\n *\n * To sync presence state from the server, first instantiate an object and\n * pass your channel in to track lifecycle events:\n *\n * ```javascript\n * let channel = socket.channel(\"some:topic\")\n * let presence = new Presence(channel)\n * ```\n *\n * Next, use the `presence.onSync` callback to react to state changes\n * from the server. For example, to render the list of users every time\n * the list changes, you could write:\n *\n * ```javascript\n * presence.onSync(() => {\n *   myRenderUsersFunction(presence.list())\n * })\n * ```\n *\n * ### Listing Presences\n *\n * `presence.list` is used to return a list of presence information\n * based on the local state of metadata. By default, all presence\n * metadata is returned, but a `listBy` function can be supplied to\n * allow the client to select which metadata to use for a given presence.\n * For example, you may have a user online from different devices with\n * a metadata status of \"online\", but they have set themselves to \"away\"\n * on another device. In this case, the app may choose to use the \"away\"\n * status for what appears on the UI. The example below defines a `listBy`\n * function which prioritizes the first metadata which was registered for\n * each user. This could be the first tab they opened, or the first device\n * they came online from:\n *\n * ```javascript\n * let listBy = (id, {metas: [first, ...rest]}) => {\n *   first.count = rest.length + 1 // count of this user's presences\n *   first.id = id\n *   return first\n * }\n * let onlineUsers = presence.list(listBy)\n * ```\n *\n * ### Handling individual presence join and leave events\n *\n * The `presence.onJoin` and `presence.onLeave` callbacks can be used to\n * react to individual presences joining and leaving the app. For example:\n *\n * ```javascript\n * let presence = new Presence(channel)\n *\n * // detect if user has joined for the 1st time or from another tab/device\n * presence.onJoin((id, current, newPres) => {\n *   if(!current){\n *     console.log(\"user has entered for the first time\", newPres)\n *   } else {\n *     console.log(\"user additional presence\", newPres)\n *   }\n * })\n *\n * // detect if user has left from all tabs/devices, or is still present\n * presence.onLeave((id, current, leftPres) => {\n *   if(current.metas.length === 0){\n *     console.log(\"user has left from all devices\", leftPres)\n *   } else {\n *     console.log(\"user left from a device\", leftPres)\n *   }\n * })\n * // receive presence data from server\n * presence.onSync(() => {\n *   displayUsers(presence.list())\n * })\n * ```\n * @module phoenix\n */\n\nconst globalSelf = typeof self !== \"undefined\" ? self : null\nconst phxWindow = typeof window !== \"undefined\" ? window : null\nconst global = globalSelf || phxWindow || this\nconst VSN = \"2.0.0\"\nconst SOCKET_STATES = {connecting: 0, open: 1, closing: 2, closed: 3}\nconst DEFAULT_TIMEOUT = 10000\nconst WS_CLOSE_NORMAL = 1000\nconst CHANNEL_STATES = {\n  closed: \"closed\",\n  errored: \"errored\",\n  joined: \"joined\",\n  joining: \"joining\",\n  leaving: \"leaving\",\n}\nconst CHANNEL_EVENTS = {\n  close: \"phx_close\",\n  error: \"phx_error\",\n  join: \"phx_join\",\n  reply: \"phx_reply\",\n  leave: \"phx_leave\"\n}\nconst CHANNEL_LIFECYCLE_EVENTS = [\n  CHANNEL_EVENTS.close,\n  CHANNEL_EVENTS.error,\n  CHANNEL_EVENTS.join,\n  CHANNEL_EVENTS.reply,\n  CHANNEL_EVENTS.leave\n]\nconst TRANSPORTS = {\n  longpoll: \"longpoll\",\n  websocket: \"websocket\"\n}\n\n// wraps value in closure or returns closure\nlet closure = (value) => {\n  if(typeof value === \"function\"){\n    return value\n  } else {\n    let closure = function(){ return value }\n    return closure\n  }\n}\n\n/**\n * Initializes the Push\n * @param {Channel} channel - The Channel\n * @param {string} event - The event, for example `\"phx_join\"`\n * @param {Object} payload - The payload, for example `{user_id: 123}`\n * @param {number} timeout - The push timeout in milliseconds\n */\nclass Push {\n  constructor(channel, event, payload, timeout){\n    this.channel      = channel\n    this.event        = event\n    this.payload      = payload || function(){ return {} }\n    this.receivedResp = null\n    this.timeout      = timeout\n    this.timeoutTimer = null\n    this.recHooks     = []\n    this.sent         = false\n  }\n\n  /**\n   *\n   * @param {number} timeout\n   */\n  resend(timeout){\n    this.timeout = timeout\n    this.reset()\n    this.send()\n  }\n\n  /**\n   *\n   */\n  send(){ if(this.hasReceived(\"timeout\")){ return }\n    this.startTimeout()\n    this.sent = true\n    this.channel.socket.push({\n      topic: this.channel.topic,\n      event: this.event,\n      payload: this.payload(),\n      ref: this.ref,\n      join_ref: this.channel.joinRef()\n    })\n  }\n\n  /**\n   *\n   * @param {*} status\n   * @param {*} callback\n   */\n  receive(status, callback){\n    if(this.hasReceived(status)){\n      callback(this.receivedResp.response)\n    }\n\n    this.recHooks.push({status, callback})\n    return this\n  }\n\n  /**\n   * @private\n   */\n  reset(){\n    this.cancelRefEvent()\n    this.ref          = null\n    this.refEvent     = null\n    this.receivedResp = null\n    this.sent         = false\n  }\n\n  /**\n   * @private\n   */\n  matchReceive({status, response, ref}){\n    this.recHooks.filter( h => h.status === status )\n                 .forEach( h => h.callback(response) )\n  }\n\n  /**\n   * @private\n   */\n  cancelRefEvent(){ if(!this.refEvent){ return }\n    this.channel.off(this.refEvent)\n  }\n\n  /**\n   * @private\n   */\n  cancelTimeout(){\n    clearTimeout(this.timeoutTimer)\n    this.timeoutTimer = null\n  }\n\n  /**\n   * @private\n   */\n  startTimeout(){ if(this.timeoutTimer){ this.cancelTimeout() }\n    this.ref      = this.channel.socket.makeRef()\n    this.refEvent = this.channel.replyEventName(this.ref)\n\n    this.channel.on(this.refEvent, payload => {\n      this.cancelRefEvent()\n      this.cancelTimeout()\n      this.receivedResp = payload\n      this.matchReceive(payload)\n    })\n\n    this.timeoutTimer = setTimeout(() => {\n      this.trigger(\"timeout\", {})\n    }, this.timeout)\n  }\n\n  /**\n   * @private\n   */\n  hasReceived(status){\n    return this.receivedResp && this.receivedResp.status === status\n  }\n\n  /**\n   * @private\n   */\n  trigger(status, response){\n    this.channel.trigger(this.refEvent, {status, response})\n  }\n}\n\n/**\n *\n * @param {string} topic\n * @param {(Object|function)} params\n * @param {Socket} socket\n */\nexport class Channel {\n  constructor(topic, params, socket) {\n    this.state       = CHANNEL_STATES.closed\n    this.topic       = topic\n    this.params      = closure(params || {})\n    this.socket      = socket\n    this.bindings    = []\n    this.bindingRef  = 0\n    this.timeout     = this.socket.timeout\n    this.joinedOnce  = false\n    this.joinPush    = new Push(this, CHANNEL_EVENTS.join, this.params, this.timeout)\n    this.pushBuffer  = []\n\n    this.rejoinTimer = new Timer(() => {\n      if(this.socket.isConnected()){ this.rejoin() }\n    }, this.socket.rejoinAfterMs)\n    this.socket.onError(() => this.rejoinTimer.reset())\n    this.socket.onOpen(() => {\n      this.rejoinTimer.reset()\n      if(this.isErrored()){ this.rejoin() }\n    })\n    this.joinPush.receive(\"ok\", () => {\n      this.state = CHANNEL_STATES.joined\n      this.rejoinTimer.reset()\n      this.pushBuffer.forEach( pushEvent => pushEvent.send() )\n      this.pushBuffer = []\n    })\n    this.joinPush.receive(\"error\", () => {\n      this.state = CHANNEL_STATES.errored\n      if(this.socket.isConnected()){ this.rejoinTimer.scheduleTimeout() }\n    })\n    this.onClose(() => {\n      this.rejoinTimer.reset()\n      if(this.socket.hasLogger()) this.socket.log(\"channel\", `close ${this.topic} ${this.joinRef()}`)\n      this.state = CHANNEL_STATES.closed\n      this.socket.remove(this)\n    })\n    this.onError(reason => {\n      if(this.socket.hasLogger()) this.socket.log(\"channel\", `error ${this.topic}`, reason)\n      if(this.isJoining()){ this.joinPush.reset() }\n      this.state = CHANNEL_STATES.errored\n      if(this.socket.isConnected()){ this.rejoinTimer.scheduleTimeout() }\n    })\n    this.joinPush.receive(\"timeout\", () => {\n      if(this.socket.hasLogger()) this.socket.log(\"channel\", `timeout ${this.topic} (${this.joinRef()})`, this.joinPush.timeout)\n      let leavePush = new Push(this, CHANNEL_EVENTS.leave, closure({}), this.timeout)\n      leavePush.send()\n      this.state = CHANNEL_STATES.errored\n      this.joinPush.reset()\n      if(this.socket.isConnected()){ this.rejoinTimer.scheduleTimeout() }\n    })\n    this.on(CHANNEL_EVENTS.reply, (payload, ref) => {\n      this.trigger(this.replyEventName(ref), payload)\n    })\n  }\n\n  /**\n   * Join the channel\n   * @param {integer} timeout\n   * @returns {Push}\n   */\n  join(timeout = this.timeout){\n    if(this.joinedOnce){\n      throw new Error(`tried to join multiple times. 'join' can only be called a single time per channel instance`)\n    } else {\n      this.timeout = timeout\n      this.joinedOnce = true\n      this.rejoin()\n      return this.joinPush\n    }\n  }\n\n  /**\n   * Hook into channel close\n   * @param {Function} callback\n   */\n  onClose(callback){\n    this.on(CHANNEL_EVENTS.close, callback)\n  }\n\n  /**\n   * Hook into channel errors\n   * @param {Function} callback\n   */\n  onError(callback){\n    return this.on(CHANNEL_EVENTS.error, reason => callback(reason))\n  }\n\n  /**\n   * Subscribes on channel events\n   *\n   * Subscription returns a ref counter, which can be used later to\n   * unsubscribe the exact event listener\n   *\n   * @example\n   * const ref1 = channel.on(\"event\", do_stuff)\n   * const ref2 = channel.on(\"event\", do_other_stuff)\n   * channel.off(\"event\", ref1)\n   * // Since unsubscription, do_stuff won't fire,\n   * // while do_other_stuff will keep firing on the \"event\"\n   *\n   * @param {string} event\n   * @param {Function} callback\n   * @returns {integer} ref\n   */\n  on(event, callback){\n    let ref = this.bindingRef++\n    this.bindings.push({event, ref, callback})\n    return ref\n  }\n\n  /**\n   * @param {string} event\n   * @param {integer} ref\n   */\n  off(event, ref){\n    this.bindings = this.bindings.filter((bind) => {\n      return !(bind.event === event && (typeof ref === \"undefined\" || ref === bind.ref))\n    })\n  }\n\n  /**\n   * @private\n   */\n  canPush(){ return this.socket.isConnected() && this.isJoined() }\n\n  /**\n   * @param {string} event\n   * @param {Object} payload\n   * @param {number} [timeout]\n   * @returns {Push}\n   */\n  push(event, payload, timeout = this.timeout){\n    if(!this.joinedOnce){\n      throw new Error(`tried to push '${event}' to '${this.topic}' before joining. Use channel.join() before pushing events`)\n    }\n    let pushEvent = new Push(this, event, function(){ return payload }, timeout)\n    if(this.canPush()){\n      pushEvent.send()\n    } else {\n      pushEvent.startTimeout()\n      this.pushBuffer.push(pushEvent)\n    }\n\n    return pushEvent\n  }\n\n  /**\n   * More memory/CPU efficient push, but does not guarantee delivery if connection is lost.\n   * @param {string} event\n   * @param {Object} payload\n   */\n  pushUnreliable(event, payload) {\n    if(!this.joinedOnce){\n      throw(`tried to push '${event}' to '${this.topic}' before joining. Use channel.join() before pushing events`)\n    }\n\n    this.socket.push({\n      topic: this.topic,\n      event, payload,\n      ref: null,\n      join_ref: this.joinRef()\n    }, false);\n  }\n\n  /** Leaves the channel\n   *\n   * Unsubscribes from server events, and\n   * instructs channel to terminate on server\n   *\n   * Triggers onClose() hooks\n   *\n   * To receive leave acknowledgements, use the a `receive`\n   * hook to bind to the server ack, ie:\n   *\n   * @example\n   * channel.leave().receive(\"ok\", () => alert(\"left!\") )\n   *\n   * @param {integer} timeout\n   * @returns {Push}\n   */\n  leave(timeout = this.timeout){\n    this.rejoinTimer.reset()\n    this.joinPush.cancelTimeout()\n\n    this.state = CHANNEL_STATES.leaving\n    let onClose = () => {\n      if(this.socket.hasLogger()) this.socket.log(\"channel\", `leave ${this.topic}`)\n      this.trigger(CHANNEL_EVENTS.close, \"leave\")\n    }\n    let leavePush = new Push(this, CHANNEL_EVENTS.leave, closure({}), timeout)\n    leavePush.receive(\"ok\", () => onClose() )\n             .receive(\"timeout\", () => onClose() )\n    leavePush.send()\n    if(!this.canPush()){ leavePush.trigger(\"ok\", {}) }\n\n    return leavePush\n  }\n\n  /**\n   * Overridable message hook\n   *\n   * Receives all events for specialized message handling\n   * before dispatching to the channel callbacks.\n   *\n   * Must return the payload, modified or unmodified\n   * @param {string} event\n   * @param {Object} payload\n   * @param {integer} ref\n   * @returns {Object}\n   */\n  onMessage(event, payload, ref){ return payload }\n\n  /**\n   * @private\n   */\n  isLifecycleEvent(event) { return CHANNEL_LIFECYCLE_EVENTS.indexOf(event) >= 0 }\n\n  /**\n   * @private\n   */\n  isMember(topic, event, payload, joinRef){\n    if(this.topic !== topic){ return false }\n\n    if(joinRef && joinRef !== this.joinRef() && this.isLifecycleEvent(event)){\n      if (this.socket.hasLogger()) this.socket.log(\"channel\", \"dropping outdated message\", {topic, event, payload, joinRef})\n      return false\n    } else {\n      return true\n    }\n  }\n\n  /**\n   * @private\n   */\n  joinRef(){ return this.joinPush.ref }\n\n  /**\n   * @private\n   */\n  sendJoin(timeout){\n    this.state = CHANNEL_STATES.joining\n    this.joinPush.resend(timeout)\n  }\n\n  /**\n   * @private\n   */\n  rejoin(timeout = this.timeout){ if(this.isLeaving()){ return }\n    this.sendJoin(timeout)\n  }\n\n  /**\n   * @private\n   */\n  trigger(event, payload, ref, joinRef){\n    let handledPayload = this.onMessage(event, payload, ref, joinRef)\n    if(payload && !handledPayload){ throw new Error(\"channel onMessage callbacks must return the payload, modified or unmodified\") }\n\n    for (let i = 0; i < this.bindings.length; i++) {\n      const bind = this.bindings[i]\n      if(bind.event !== event){ continue }\n      bind.callback(handledPayload, ref, joinRef || this.joinRef())\n    }\n  }\n\n  /**\n   * @private\n   */\n  replyEventName(ref){ return `chan_reply_${ref}` }\n\n  /**\n   * @private\n   */\n  isClosed() { return this.state === CHANNEL_STATES.closed }\n\n  /**\n   * @private\n   */\n  isErrored(){ return this.state === CHANNEL_STATES.errored }\n\n  /**\n   * @private\n   */\n  isJoined() { return this.state === CHANNEL_STATES.joined }\n\n  /**\n   * @private\n   */\n  isJoining(){ return this.state === CHANNEL_STATES.joining }\n\n  /**\n   * @private\n   */\n  isLeaving(){ return this.state === CHANNEL_STATES.leaving }\n}\n\n/* The default serializer for encoding and decoding messages */\nexport let Serializer = {\n  encode(msg, callback){\n    let payload = [\n      msg.join_ref, msg.ref, msg.topic, msg.event, msg.payload\n    ]\n    return callback(JSON.stringify(payload))\n  },\n\n  decode(rawPayload, callback){\n    let [join_ref, ref, topic, event, payload] = JSON.parse(rawPayload)\n\n    return callback({join_ref, ref, topic, event, payload})\n  }\n}\n\n\n/** Initializes the Socket\n *\n *\n * For IE8 support use an ES5-shim (https://github.com/es-shims/es5-shim)\n *\n * @param {string} endPoint - The string WebSocket endpoint, ie, `\"ws://example.com/socket\"`,\n *                                               `\"wss://example.com\"`\n *                                               `\"/socket\"` (inherited host & protocol)\n * @param {Object} [opts] - Optional configuration\n * @param {string} [opts.transport] - The Websocket Transport, for example WebSocket or Phoenix.LongPoll.\n *\n * Defaults to WebSocket with automatic LongPoll fallback.\n * @param {Function} [opts.encode] - The function to encode outgoing messages.\n *\n * Defaults to JSON encoder.\n *\n * @param {Function} [opts.decode] - The function to decode incoming messages.\n *\n * Defaults to JSON:\n *\n * ```javascript\n * (payload, callback) => callback(JSON.parse(payload))\n * ```\n *\n * @param {number} [opts.timeout] - The default timeout in milliseconds to trigger push timeouts.\n *\n * Defaults `DEFAULT_TIMEOUT`\n * @param {number} [opts.heartbeatIntervalMs] - The millisec interval to send a heartbeat message\n * @param {number} [opts.reconnectAfterMs] - The optional function that returns the millsec\n * socket reconnect interval.\n *\n * Defaults to stepped backoff of:\n *\n * ```javascript\n * function(tries){\n *   return [10, 50, 100, 150, 200, 250, 500, 1000, 2000][tries - 1] || 5000\n * }\n * ````\n *\n * @param {number} [opts.rejoinAfterMs] - The optional function that returns the millsec\n * rejoin interval for individual channels.\n *\n * ```javascript\n * function(tries){\n *   return [1000, 2000, 5000][tries - 1] || 10000\n * }\n * ````\n *\n * @param {Function} [opts.logger] - The optional function for specialized logging, ie:\n *\n * ```javascript\n * function(kind, msg, data) {\n *   console.log(`${kind}: ${msg}`, data)\n * }\n * ```\n *\n * @param {number} [opts.longpollerTimeout] - The maximum timeout of a long poll AJAX request.\n *\n * Defaults to 20s (double the server long poll timer).\n *\n * @param {{Object|function)} [opts.params] - The optional params to pass when connecting\n * @param {string} [opts.binaryType] - The binary type to use for binary WebSocket frames.\n *\n * Defaults to \"arraybuffer\"\n *\n*/\nexport class Socket {\n  constructor(endPoint, opts = {}){\n    this.stateChangeCallbacks = {open: [], close: [], error: [], message: []}\n    this.channels             = []\n    this.sendBuffer           = []\n    this.ref                  = 0\n    this.timeout              = opts.timeout || DEFAULT_TIMEOUT\n    this.transport            = opts.transport || global.WebSocket || LongPoll\n    this.defaultEncoder       = Serializer.encode\n    this.defaultDecoder       = Serializer.decode\n    this.closeWasClean        = false\n    this.unloaded             = false\n    this.binaryType           = opts.binaryType || \"arraybuffer\"\n    if(this.transport !== LongPoll){\n      this.encode = opts.encode || this.defaultEncoder\n      this.decode = opts.decode || this.defaultDecoder\n    } else {\n      this.encode = this.defaultEncoder\n      this.decode = this.defaultDecoder\n    }\n    if(phxWindow && phxWindow.addEventListener){\n      phxWindow.addEventListener(\"beforeunload\", e => {\n        if(this.conn){\n          this.unloaded = true\n          this.abnormalClose(\"unloaded\")\n        }\n      })\n    }\n    this.heartbeatIntervalMs = opts.heartbeatIntervalMs || 30000\n    this.rejoinAfterMs = (tries) => {\n      if(opts.rejoinAfterMs){\n        return opts.rejoinAfterMs(tries)\n      } else {\n        return [1000, 2000, 5000][tries - 1] || 10000\n      }\n    }\n    this.reconnectAfterMs = (tries) => {\n      if(this.unloaded){ return 100 }\n      if(opts.reconnectAfterMs){\n        return opts.reconnectAfterMs(tries)\n      } else {\n        return [10, 50, 100, 150, 200, 250, 500, 1000, 2000][tries - 1] || 5000\n      }\n    }\n    this.logger               = opts.logger || null\n    this.longpollerTimeout    = opts.longpollerTimeout || 20000\n    this.params               = closure(opts.params || {})\n    this.endPoint             = `${endPoint}/${TRANSPORTS.websocket}`\n    this.heartbeatTimer       = null\n    this.pendingHeartbeatRef  = null\n    this.reconnectTimer       = new Timer(() => {\n      this.teardown(() => this.connect())\n    }, this.reconnectAfterMs)\n  }\n\n  /**\n   * Returns the socket protocol\n   *\n   * @returns {string}\n   */\n  protocol(){ return location.protocol.match(/^https/) ? \"wss\" : \"ws\" }\n\n  /**\n   * The fully qualifed socket url\n   *\n   * @returns {string}\n   */\n  endPointURL(){\n    let uri = Ajax.appendParams(\n      Ajax.appendParams(this.endPoint, this.params()), {vsn: VSN})\n    if(uri.charAt(0) !== \"/\"){ return uri }\n    if(uri.charAt(1) === \"/\"){ return `${this.protocol()}:${uri}` }\n\n    return `${this.protocol()}://${location.host}${uri}`\n  }\n\n  /**\n   * @param {Function} callback\n   * @param {integer} code\n   * @param {string} reason\n   */\n  disconnect(callback, code, reason){\n    this.closeWasClean = true\n    this.reconnectTimer.reset()\n    this.teardown(callback, code, reason)\n  }\n\n  /**\n   *\n   * @param {Object} params - The params to send when connecting, for example `{user_id: userToken}`\n   *\n   * Passing params to connect is deprecated; pass them in the Socket constructor instead:\n   * `new Socket(\"/socket\", {params: {user_id: userToken}})`.\n   */\n  connect(params){\n    if(params){\n      console && console.log(\"passing params to connect is deprecated. Instead pass :params to the Socket constructor\")\n      this.params = closure(params)\n    }\n    if(this.conn){ return }\n    this.closeWasClean = false\n    this.conn = new this.transport(this.endPointURL())\n    this.conn.binaryType = this.binaryType\n    this.conn.timeout    = this.longpollerTimeout\n    this.conn.onopen     = () => this.onConnOpen()\n    this.conn.onerror    = error => this.onConnError(error)\n    this.conn.onmessage  = event => this.onConnMessage(event)\n    this.conn.onclose    = event => this.onConnClose(event)\n  }\n\n  /**\n   * Logs the message. Override `this.logger` for specialized logging. noops by default\n   * @param {string} kind\n   * @param {string} msg\n   * @param {Object} data\n   */\n  log(kind, msg, data){ this.logger(kind, msg, data) }\n\n  /**\n   * Returns true if a logger has been set on this socket.\n   */\n  hasLogger(){ return this.logger !== null }\n\n  /**\n   * Registers callbacks for connection open events\n   *\n   * @example socket.onOpen(function(){ console.info(\"the socket was opened\") })\n   *\n   * @param {Function} callback\n   */\n  onOpen(callback){ this.stateChangeCallbacks.open.push(callback) }\n\n  /**\n   * Registers callbacks for connection close events\n   * @param {Function} callback\n   */\n  onClose(callback){ this.stateChangeCallbacks.close.push(callback) }\n\n  /**\n   * Registers callbacks for connection error events\n   *\n   * @example socket.onError(function(error){ alert(\"An error occurred\") })\n   *\n   * @param {Function} callback\n   */\n  onError(callback){ this.stateChangeCallbacks.error.push(callback) }\n\n  /**\n   * Registers callbacks for connection message events\n   * @param {Function} callback\n   */\n  onMessage(callback){ this.stateChangeCallbacks.message.push(callback) }\n\n  /**\n   * @private\n   */\n  onConnOpen(){\n    if (this.hasLogger()) this.log(\"transport\", `connected to ${this.endPointURL()}`)\n    this.unloaded = false\n    this.closeWasClean = false\n    this.flushSendBuffer()\n    this.reconnectTimer.reset()\n    this.resetHeartbeat()\n    this.stateChangeCallbacks.open.forEach( callback => callback() )\n  }\n\n  /**\n   * @private\n   */\n\n  resetHeartbeat(){ if(this.conn && this.conn.skipHeartbeat){ return }\n    this.pendingHeartbeatRef = null\n    clearInterval(this.heartbeatTimer)\n    this.heartbeatTimer = setInterval(() => this.sendHeartbeat(), this.heartbeatIntervalMs)\n  }\n\n  teardown(callback, code, reason){\n    if(this.conn){\n      this.conn.onclose = function(){} // noop\n      if(code){ this.conn.close(code, reason || \"\") } else { this.conn.close() }\n      this.conn = null\n    }\n    callback && callback()\n  }\n\n  onConnClose(event){\n    if (this.hasLogger()) this.log(\"transport\", \"close\", event)\n    this.triggerChanError()\n    clearInterval(this.heartbeatTimer)\n    if(!this.closeWasClean){\n      this.reconnectTimer.scheduleTimeout()\n    }\n    this.stateChangeCallbacks.close.forEach( callback => callback(event) )\n  }\n\n  /**\n   * @private\n   */\n  onConnError(error){\n    if (this.hasLogger()) this.log(\"transport\", error)\n    this.triggerChanError()\n    this.stateChangeCallbacks.error.forEach( callback => callback(error) )\n  }\n\n  /**\n   * @private\n   */\n  triggerChanError(){\n    this.channels.forEach( channel => {\n      if(!(channel.isErrored() || channel.isLeaving() || channel.isClosed())){\n        channel.trigger(CHANNEL_EVENTS.error)\n      }\n    })\n  }\n\n  /**\n   * @returns {string}\n   */\n  connectionState(){\n    switch(this.conn && this.conn.readyState){\n      case SOCKET_STATES.connecting: return \"connecting\"\n      case SOCKET_STATES.open:       return \"open\"\n      case SOCKET_STATES.closing:    return \"closing\"\n      default:                       return \"closed\"\n    }\n  }\n\n  /**\n   * @returns {boolean}\n   */\n  isConnected(){ return this.connectionState() === \"open\" }\n\n  /**\n   * @param {Channel}\n   */\n  remove(channel){\n    this.channels = this.channels.filter(c => c.joinRef() !== channel.joinRef())\n  }\n\n  /**\n   * Initiates a new channel for the given topic\n   *\n   * @param {string} topic\n   * @param {Object} chanParams - Parameters for the channel\n   * @returns {Channel}\n   */\n  channel(topic, chanParams = {}){\n    let chan = new Channel(topic, chanParams, this)\n    this.channels.push(chan)\n    return chan\n  }\n\n  /**\n   * @param {Object} data\n   */\n  push(data, reliable = true){\n    if (this.hasLogger()) {\n      let {topic, event, payload, ref, join_ref} = data\n      this.log(\"push\", `${topic} ${event} (${join_ref}, ${ref})`, payload)\n    }\n\n    if(this.isConnected()){\n      this.encode(data, result => this.conn.send(result))\n    } else if (reliable) {\n      this.sendBuffer.push(() => this.encode(data, result => this.conn.send(result)))\n    }\n  }\n\n  /**\n   * Return the next message ref, accounting for overflows\n   * @returns {string}\n   */\n  makeRef(){\n    let newRef = this.ref + 1\n    if(newRef === this.ref){ this.ref = 0 } else { this.ref = newRef }\n\n    return this.ref.toString()\n  }\n\n  sendHeartbeat(){ if(!this.isConnected()){ return }\n    if(this.pendingHeartbeatRef){\n      this.pendingHeartbeatRef = null\n      if (this.hasLogger()) this.log(\"transport\", \"heartbeat timeout. Attempting to re-establish connection\")\n      this.abnormalClose(\"heartbeat timeout\")\n      return\n    }\n    this.pendingHeartbeatRef = this.makeRef()\n    this.push({topic: \"phoenix\", event: \"heartbeat\", payload: {}, ref: this.pendingHeartbeatRef})\n  }\n\n  abnormalClose(reason){\n    this.closeWasClean = false\n    this.conn.close(WS_CLOSE_NORMAL, reason)\n  }\n\n  flushSendBuffer(){\n    if(this.isConnected() && this.sendBuffer.length > 0){\n      this.sendBuffer.forEach( callback => callback() )\n      this.sendBuffer = []\n    }\n  }\n\n  onConnMessage(rawMessage){\n    this.decode(rawMessage.data, msg => {\n      let {topic, event, payload, ref, join_ref} = msg\n      if(ref && ref === this.pendingHeartbeatRef){ this.pendingHeartbeatRef = null }\n\n      if (this.hasLogger()) this.log(\"receive\", `${payload.status || \"\"} ${topic} ${event} ${ref && \"(\" + ref + \")\" || \"\"}`, payload)\n\n      for (let i = 0; i < this.channels.length; i++) {\n        const channel = this.channels[i]\n        if(!channel.isMember(topic, event, payload, join_ref)){ continue }\n        channel.trigger(event, payload, ref, join_ref)\n      }\n\n      for (let i = 0; i < this.stateChangeCallbacks.message.length; i++) {\n        this.stateChangeCallbacks.message[i](msg)\n      }\n    })\n  }\n}\n\n\nexport class LongPoll {\n\n  constructor(endPoint){\n    this.endPoint        = null\n    this.token           = null\n    this.skipHeartbeat   = true\n    this.onopen          = function(){} // noop\n    this.onerror         = function(){} // noop\n    this.onmessage       = function(){} // noop\n    this.onclose         = function(){} // noop\n    this.pollEndpoint    = this.normalizeEndpoint(endPoint)\n    this.readyState      = SOCKET_STATES.connecting\n\n    this.poll()\n  }\n\n  normalizeEndpoint(endPoint){\n    return(endPoint\n      .replace(\"ws://\", \"http://\")\n      .replace(\"wss://\", \"https://\")\n      .replace(new RegExp(\"(.*)\\/\" + TRANSPORTS.websocket), \"$1/\" + TRANSPORTS.longpoll))\n  }\n\n  endpointURL(){\n    return Ajax.appendParams(this.pollEndpoint, {token: this.token})\n  }\n\n  closeAndRetry(){\n    this.close()\n    this.readyState = SOCKET_STATES.connecting\n  }\n\n  ontimeout(){\n    this.onerror(\"timeout\")\n    this.closeAndRetry()\n  }\n\n  poll(){\n    if(!(this.readyState === SOCKET_STATES.open || this.readyState === SOCKET_STATES.connecting)){ return }\n\n    Ajax.request(\"GET\", this.endpointURL(), \"application/json\", null, this.timeout, this.ontimeout.bind(this), (resp) => {\n      if(resp){\n        var {status, token, messages} = resp\n        this.token = token\n      } else{\n        var status = 0\n      }\n\n      switch(status){\n        case 200:\n          messages.forEach(msg => this.onmessage({data: msg}))\n          this.poll()\n          break\n        case 204:\n          this.poll()\n          break\n        case 410:\n          this.readyState = SOCKET_STATES.open\n          this.onopen()\n          this.poll()\n          break\n        case 0:\n        case 500:\n          this.onerror()\n          this.closeAndRetry()\n          break\n        default: throw new Error(`unhandled poll status ${status}`)\n      }\n    })\n  }\n\n  send(body){\n    Ajax.request(\"POST\", this.endpointURL(), \"application/json\", body, this.timeout, this.onerror.bind(this, \"timeout\"), (resp) => {\n      if(!resp || resp.status !== 200){\n        this.onerror(resp && resp.status)\n        this.closeAndRetry()\n      }\n    })\n  }\n\n  close(code, reason){\n    this.readyState = SOCKET_STATES.closed\n    this.onclose()\n  }\n}\n\nexport class Ajax {\n\n  static request(method, endPoint, accept, body, timeout, ontimeout, callback){\n    if(global.XDomainRequest){\n      let req = new XDomainRequest() // IE8, IE9\n      this.xdomainRequest(req, method, endPoint, body, timeout, ontimeout, callback)\n    } else {\n      let req = global.XMLHttpRequest ?\n                  new global.XMLHttpRequest() : // IE7+, Firefox, Chrome, Opera, Safari\n                  new ActiveXObject(\"Microsoft.XMLHTTP\") // IE6, IE5\n      this.xhrRequest(req, method, endPoint, accept, body, timeout, ontimeout, callback)\n    }\n  }\n\n  static xdomainRequest(req, method, endPoint, body, timeout, ontimeout, callback){\n    req.timeout = timeout\n    req.open(method, endPoint)\n    req.onload = () => {\n      let response = this.parseJSON(req.responseText)\n      callback && callback(response)\n    }\n    if(ontimeout){ req.ontimeout = ontimeout }\n\n    // Work around bug in IE9 that requires an attached onprogress handler\n    req.onprogress = () => {}\n\n    req.send(body)\n  }\n\n  static xhrRequest(req, method, endPoint, accept, body, timeout, ontimeout, callback){\n    req.open(method, endPoint, true)\n    req.timeout = timeout\n    req.setRequestHeader(\"Content-Type\", accept)\n    req.onerror = () => { callback && callback(null) }\n    req.onreadystatechange = () => {\n      if(req.readyState === this.states.complete && callback){\n        let response = this.parseJSON(req.responseText)\n        callback(response)\n      }\n    }\n    if(ontimeout){ req.ontimeout = ontimeout }\n\n    req.send(body)\n  }\n\n  static parseJSON(resp){\n    if(!resp || resp === \"\"){ return null }\n\n    try {\n      return JSON.parse(resp)\n    } catch(e) {\n      console && console.log(\"failed to parse JSON response\", resp)\n      return null\n    }\n  }\n\n  static serialize(obj, parentKey){\n    let queryStr = []\n    for(var key in obj){ if(!obj.hasOwnProperty(key)){ continue }\n      let paramKey = parentKey ? `${parentKey}[${key}]` : key\n      let paramVal = obj[key]\n      if(typeof paramVal === \"object\"){\n        queryStr.push(this.serialize(paramVal, paramKey))\n      } else {\n        queryStr.push(encodeURIComponent(paramKey) + \"=\" + encodeURIComponent(paramVal))\n      }\n    }\n    return queryStr.join(\"&\")\n  }\n\n  static appendParams(url, params){\n    if(Object.keys(params).length === 0){ return url }\n\n    let prefix = url.match(/\\?/) ? \"&\" : \"?\"\n    return `${url}${prefix}${this.serialize(params)}`\n  }\n}\n\nAjax.states = {complete: 4}\n\n/**\n * Initializes the Presence\n * @param {Channel} channel - The Channel\n * @param {Object} opts - The options,\n *        for example `{events: {state: \"state\", diff: \"diff\"}}`\n */\nexport class Presence {\n\n  constructor(channel, opts = {}){\n    let events = opts.events || {state: \"presence_state\", diff: \"presence_diff\"}\n    this.state = {}\n    this.pendingDiffs = []\n    this.channel = channel\n    this.joinRef = null\n    this.caller = {\n      onJoin: function(){},\n      onLeave: function(){},\n      onSync: function(){}\n    }\n\n    this.channel.on(events.state, newState => {\n      let {onJoin, onLeave, onSync} = this.caller\n\n      this.joinRef = this.channel.joinRef()\n      this.state = Presence.syncState(this.state, newState, onJoin, onLeave)\n\n      this.pendingDiffs.forEach(diff => {\n        this.state = Presence.syncDiff(this.state, diff, onJoin, onLeave)\n      })\n      this.pendingDiffs = []\n      onSync()\n    })\n\n    this.channel.on(events.diff, diff => {\n      let {onJoin, onLeave, onSync} = this.caller\n\n      if(this.inPendingSyncState()){\n        this.pendingDiffs.push(diff)\n      } else {\n        this.state = Presence.syncDiff(this.state, diff, onJoin, onLeave)\n        onSync()\n      }\n    })\n  }\n\n  onJoin(callback){ this.caller.onJoin = callback }\n\n  onLeave(callback){ this.caller.onLeave = callback }\n\n  onSync(callback){ this.caller.onSync = callback }\n\n  list(by){ return Presence.list(this.state, by) }\n\n  inPendingSyncState(){\n    return !this.joinRef || (this.joinRef !== this.channel.joinRef())\n  }\n\n  // lower-level public static API\n\n  /**\n   * Used to sync the list of presences on the server\n   * with the client's state. An optional `onJoin` and `onLeave` callback can\n   * be provided to react to changes in the client's local presences across\n   * disconnects and reconnects with the server.\n   *\n   * @returns {Presence}\n   */\n  static syncState(currentState, newState, onJoin, onLeave){\n    let state = this.clone(currentState)\n    let joins = {}\n    let leaves = {}\n\n    this.map(state, (key, presence) => {\n      if(!newState[key]){\n        leaves[key] = presence\n      }\n    })\n    this.map(newState, (key, newPresence) => {\n      let currentPresence = state[key]\n      if(currentPresence){\n        let newRefs = newPresence.metas.map(m => m.phx_ref)\n        let curRefs = currentPresence.metas.map(m => m.phx_ref)\n        let joinedMetas = newPresence.metas.filter(m => curRefs.indexOf(m.phx_ref) < 0)\n        let leftMetas = currentPresence.metas.filter(m => newRefs.indexOf(m.phx_ref) < 0)\n        if(joinedMetas.length > 0){\n          joins[key] = newPresence\n          joins[key].metas = joinedMetas\n        }\n        if(leftMetas.length > 0){\n          leaves[key] = this.clone(currentPresence)\n          leaves[key].metas = leftMetas\n        }\n      } else {\n        joins[key] = newPresence\n      }\n    })\n    return this.syncDiff(state, {joins: joins, leaves: leaves}, onJoin, onLeave)\n  }\n\n  /**\n   *\n   * Used to sync a diff of presence join and leave\n   * events from the server, as they happen. Like `syncState`, `syncDiff`\n   * accepts optional `onJoin` and `onLeave` callbacks to react to a user\n   * joining or leaving from a device.\n   *\n   * @returns {Presence}\n   */\n  static syncDiff(currentState, {joins, leaves}, onJoin, onLeave){\n    let state = this.clone(currentState)\n    if(!onJoin){ onJoin = function(){} }\n    if(!onLeave){ onLeave = function(){} }\n\n    this.map(joins, (key, newPresence) => {\n      let currentPresence = state[key]\n      state[key] = newPresence\n      if(currentPresence){\n        let joinedRefs = state[key].metas.map(m => m.phx_ref)\n        let curMetas = currentPresence.metas.filter(m => joinedRefs.indexOf(m.phx_ref) < 0)\n        state[key].metas.unshift(...curMetas)\n      }\n      onJoin(key, currentPresence, newPresence)\n    })\n    this.map(leaves, (key, leftPresence) => {\n      let currentPresence = state[key]\n      if(!currentPresence){ return }\n      let refsToRemove = leftPresence.metas.map(m => m.phx_ref)\n      currentPresence.metas = currentPresence.metas.filter(p => {\n        return refsToRemove.indexOf(p.phx_ref) < 0\n      })\n      onLeave(key, currentPresence, leftPresence)\n      if(currentPresence.metas.length === 0){\n        delete state[key]\n      }\n    })\n    return state\n  }\n\n  /**\n   * Returns the array of presences, with selected metadata.\n   *\n   * @param {Object} presences\n   * @param {Function} chooser\n   *\n   * @returns {Presence}\n   */\n  static list(presences, chooser){\n    if(!chooser){ chooser = function(key, pres){ return pres } }\n\n    return this.map(presences, (key, presence) => {\n      return chooser(key, presence)\n    })\n  }\n\n  // private\n\n  static map(obj, func){\n    return Object.getOwnPropertyNames(obj).map(key => func(key, obj[key]))\n  }\n\n  static clone(obj){ return JSON.parse(JSON.stringify(obj)) }\n}\n\n\n/**\n *\n * Creates a timer that accepts a `timerCalc` function to perform\n * calculated timeout retries, such as exponential backoff.\n *\n * @example\n * let reconnectTimer = new Timer(() => this.connect(), function(tries){\n *   return [1000, 5000, 10000][tries - 1] || 10000\n * })\n * reconnectTimer.scheduleTimeout() // fires after 1000\n * reconnectTimer.scheduleTimeout() // fires after 5000\n * reconnectTimer.reset()\n * reconnectTimer.scheduleTimeout() // fires after 1000\n *\n * @param {Function} callback\n * @param {Function} timerCalc\n */\nclass Timer {\n  constructor(callback, timerCalc){\n    this.callback  = callback\n    this.timerCalc = timerCalc\n    this.timer     = null\n    this.tries     = 0\n  }\n\n  reset(){\n    this.tries = 0\n    clearTimeout(this.timer)\n  }\n\n  /**\n   * Cancels any previous scheduleTimeout and schedules callback\n   */\n  scheduleTimeout(){\n    clearTimeout(this.timer)\n\n    this.timer = setTimeout(() => {\n      this.tries = this.tries + 1\n      this.callback()\n    }, this.timerCalc(this.tries + 1))\n  }\n}\n"],"sourceRoot":""}